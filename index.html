<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hotel Drinks On Demand - Fast Nationwide Delivery</title>
  <meta name="theme-color" content="#38bdf8" />
  <link rel="manifest" href="manifest.json">
  <meta property="og:title" content="Hotel Drinks On Demand - Fast Nationwide Delivery">
    <meta property="og:description" content="Order your favorite drinks delivered straight to your hotel or apartment in minutes!">
    <meta property="og:image" content="https://static.wixstatic.com/media/cfe6d1_78032b33403248fa9e115d7d1cbf037a~mv2.png">
    <meta property="og:url" content="https://kingamada.github.io/HotelDrinks/index.html">
    <meta property="og:type" content="website">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Hotel Drinks On Demand">
    <meta name="twitter:description" content="Fast and affordable drinks delivered to your hotel or apartment!">
    <meta name="twitter:image" content="https://static.wixstatic.com/media/cfe6d1_78032b33403248fa9e115d7d1cbf037a~mv2.png">
    <meta name="twitter:url" content="https://kingamada.github.io/HotelDrinks/index.html">
  <!-- put just above your Tailwind script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" sizes="32x32" href="https://static.wixstatic.com/media/cfe6d1_a9399cf7441140b6b0afd1508a69e17d~mv2.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --ease-elastic:cubic-bezier(.68,-0.55,.27,1.55);
    }
    .tilt   {transition:transform .25s var(--ease-elastic);}
    .no‑tap {touch-action:manipulation;user-select:none;-webkit-user-select:none;}
  </style>

  <style>
    :root {
      --primary-color: #38bdf8; /* sky-500 */
      --primary-hover-color: #0ea5e9; /* sky-600 */
      --primary-dark-color: #0c4a6e; /* sky-800 */
      --secondary-color: #f0f9ff; /* sky-50, more hydrating */
      --text-color: #0f172a; /* slate-900 */
      --text-light-color: #475569; /* slate-600 */
      --border-color: #cbd5e1; /* slate-300 */
      --input-bg-color: #ffffff;
      --card-bg-color: #ffffff;
      --default-font: 'Inter', sans-serif;
      --border-radius: 0.75rem; /* Slightly larger */
      --input-border-radius: 0.5rem; /* Slightly larger */

      /* New Gradient & Animation Variables */
      --hero-gradient-start: #0ea5e9; /* sky-600 */
      --hero-gradient-mid: #38bdf8;   /* sky-500 */
      --hero-gradient-end: #06b6d4;   /* cyan-500 */
      --button-glow: 0 0 15px rgba(56, 189, 248, 0.5);
      --card-hover-shadow: 0 12px 25px -5px rgba(0,0,0,0.15), 0 8px 10px -6px rgba(0,0,0,0.1);
      --link-hover-color: var(--primary-hover-color);
      --ripple-color: rgba(255, 255, 255, 0.6);
    }
    body {
        font-family: var(--default-font);
        background-color: var(--secondary-color);
        color: var(--text-color);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        /* Optional: Subtle body gradient for more depth */
        /* background-image: linear-gradient(to bottom, #f0f9ff, #e0f2fe); */
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--secondary-color);}
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px;}
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Ripple Effect Base */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background-color: var(--ripple-color);
      transform: scale(0);
      animation: ripple-animation 0.6s linear;
      pointer-events: none;
    }
    @keyframes ripple-animation {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: var(--input-border-radius);
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother transition */
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px -1px rgba(0,0,0,0.1);
        position: relative; /* For ripple */
        overflow: hidden;   /* For ripple */
    }
    .btn-primary {
        background-color: var(--primary-color);
        color: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn-primary:hover {
        background-color: var(--primary-hover-color);
        transform: translateY(-2px) scale(1.02);
        box-shadow: var(--button-glow), 0 6px 12px -1px rgba(0,0,0,0.15);
    }
    .btn-primary:disabled { background-color: #94a3b8; cursor: not-allowed; box-shadow: none; transform: none;}
    .btn-primary:active {
        transform: translateY(-1px) scale(0.98);
    }
    .btn-secondary { background-color: var(--card-bg-color); color: var(--primary-dark-color); border: 1px solid var(--border-color);}
    .btn-secondary:hover {
        background-color: #f8fafc;
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
    }

    /* Navigation */
    .nav-link {
        transition: color 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }
    .nav-link:hover {
        color: var(--link-hover-color);
        transform: translateY(-1px);
    }
    .nav-link.active {
        color: var(--primary-color);
        border-bottom: 2px solid var(--primary-color);
        font-weight: 600;
    }
    #mobile-menu a.block:hover {
        background-color: rgba(56, 189, 248, 0.1); /* sky-500 with 10% opacity */
        color: var(--primary-hover-color);
        transform: translateX(3px);
        transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }
     header .flex.items-center > a { /* The logo link */
        transition: transform 0.3s ease;
    }
    header .flex.items-center > a:hover {
        transform: scale(1.03) rotate(-2deg);
    }
    header .flex.items-center > a:hover i {
        animation: logoIconSpin 0.8s ease-in-out;
    }
    @keyframes logoIconSpin {
        0% { transform: rotate(0deg) scale(1); }
        25% { transform: rotate(15deg) scale(1.1); color: var(--primary-hover-color);}
        50% { transform: rotate(-10deg) scale(1.1); }
        75% { transform: rotate(5deg) scale(1.1); }
        100% { transform: rotate(0deg) scale(1); color: var(--primary-color);}
    }


    /* Cards */
    .card {
        background-color: var(--card-bg-color);
        border-radius: var(--border-radius);
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.07);
        overflow: hidden;
        transition: transform 0.35s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
        border: 1px solid transparent; /* Prepare for hover border */
    }
    .card:hover {
      /* border-color: var(--primary-color); */ /* Optional subtle border */
      box-shadow: var(--card-hover-shadow);
    }
    .product-card {
        transition: transform 0.35s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .product-card:hover {
        transform: translateY(-8px) scale(1.03); /* Enhanced hover */
        box-shadow: var(--card-hover-shadow);
    }
    .product-image { width: 100%; height: 12rem; object-fit: cover;}

    /* Hero Section */
    .hero-gradient-animated { /* Apply this class to the hero background div */
      background: linear-gradient(120deg, var(--hero-gradient-start), var(--hero-gradient-mid), var(--hero-gradient-end), var(--hero-gradient-start));
      background-size: 300% 300%; /* Needs to be larger than 100% for movement */
      animation: gradientFlow 18s ease infinite;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .hero-text h1, .hero-text p:not(:last-of-type), .hero-text button { /* Target specific p if needed */
      animation: heroTextFadeInUp 0.8s 0.2s backwards cubic-bezier(0.23, 1, 0.32, 1);
    }
    .hero-text p:not(:last-of-type) { animation-delay: 0.4s; } /* First p tag */
    .hero-text button { animation-delay: 0.6s; }
    .hero-text p:last-of-type { animation: heroTextFadeInUp 0.8s 0.8s backwards cubic-bezier(0.23, 1, 0.32, 1); } /* Second p tag, delayed more */


    @keyframes heroTextFadeInUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .hero-text button { /* Special animation for hero button */
        animation: pulseButton 2s infinite ease-in-out 1s, heroTextFadeInUp 0.8s 0.6s backwards cubic-bezier(0.23, 1, 0.32, 1); /* Combine animations */
    }
    @keyframes pulseButton {
        0% { transform: scale(1); box-shadow: 0 6px 12px -1px rgba(255,255,255,0.1); }
        50% { transform: scale(1.05); box-shadow: 0 8px 16px -1px rgba(255,255,255,0.2), 0 0 15px rgba(255,255,255,0.3); }
        100% { transform: scale(1); box-shadow: 0 6px 12px -1px rgba(255,255,255,0.1); }
    }
    .hero-text button:hover {
        animation-play-state: paused; /* Pause pulse on hover */
        transform: scale(1.1) translateY(-2px) !important; /* Ensure hover takes precedence over pulse scale */
    }

    .hero-image-container { position: relative; width: 100%; height: 100%; min-height: 300px; overflow: hidden;}
    .hero-image-container img { width: 100%; height: 100%; object-fit: cover; position: absolute; top:0; left:0; opacity: 0; transition: opacity 1s ease-in-out, transform 1s ease-in-out; transform: scale(1.05); }
    .hero-image-container img.active { opacity: 1; transform: scale(1); }

    /* Modals */
    .modal {
        display: none; position: fixed; z-index: 1000; left: 0; top: 0;
        width: 100%; height: 100%; overflow: auto;
        background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); /* Increased blur */
        align-items: center; justify-content: center;
        opacity: 0;
        /* transform: scale(0.95); */ /* Let's animate modal content instead */
        transition: opacity 0.3s ease;
    }
    .modal.open { /* Add this class with JS */
      opacity: 1;
      /* transform: scale(1); */
      display:flex; /* Use flex after open to ensure it's rendered for transition */
    }
    .modal-content {
        background-color: var(--card-bg-color); padding: 2rem; border-radius: var(--border-radius);
        width: 90%; max-width: 500px;
        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
        margin: auto;
        transform: translateY(30px) scale(0.95);
        opacity: 0;
        transition: transform 0.35s 0.05s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.35s 0.05s cubic-bezier(0.25, 0.8, 0.25, 1); /* Slight delay for content */
    }
    .modal.open .modal-content {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    .modal-close { color: #9ca3af; float: right; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s ease, transform 0.2s ease;}
    .modal-close:hover { color: var(--text-color); transform: rotate(90deg); }

    main { padding-top: 5rem;}
    #map { height: 280px; border-radius: var(--input-border-radius); margin-bottom: 1rem; border: 1px solid var(--border-color);}

    .hotel-list-item { cursor: pointer; padding: 0.75rem 1rem; border-radius: var(--input-border-radius); transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease; border: 1px solid transparent; }
    .hotel-list-item:hover { background-color: #e0f2fe80; border-color: var(--primary-color); transform: translateX(4px); }
    .hotel-list-item.selected { background-color: #bae6fd; color: var(--primary-dark-color); font-weight: 600; border-color: var(--primary-color); transform: translateX(2px); }

    .why-us-card {
        background: var(--card-bg-color); border-radius: var(--border-radius); padding: 2rem;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.07);
        text-align: center;
        transition: transform 0.35s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .why-us-card:hover {
      transform: scale(1.05) translateY(-6px); /* Combined effect */
      box-shadow: var(--card-hover-shadow);
    }
    .why-us-card i {
        font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-color);
        transition: transform 0.3s ease, color 0.3s ease;
    }
    .why-us-card:hover i {
      transform: scale(1.15) rotate(-5deg);
      color: var(--primary-hover-color); /* Icon color change on hover */
    }

    /* How it works icons */
    #how-it-works .flex.flex-col > div:first-child { /* The icon container */
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    #how-it-works .flex.flex-col:hover > div:first-child {
        transform: translateY(-6px) scale(1.08);
        box-shadow: 0 0 25px var(--button-glow);
    }
    #how-it-works .flex.flex-col i {
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Bouncy */
    }
    #how-it-works .flex.flex-col:hover i {
        transform: scale(1.1) rotate(-8deg) translateY(-3px);
    }


    .star-rating .fa-star { font-size: 2rem; color: #e5e7eb; cursor: pointer; transition: color 0.2s, transform 0.2s; }
    .star-rating .fa-star.selected, .star-rating .fa-star:hover, .star-rating .fa-star:hover ~ .fa-star { color: #f59e0b; transform: scale(1.15); }

    .input-field, .select-field {
        background-color: var(--input-bg-color); border: 1px solid var(--border-color);
        border-radius: var(--input-border-radius); padding: 0.65rem 0.9rem; width: 100%;
        transition: border-color 0.2s ease, box-shadow 0.2s ease; font-size: 0.95rem; color: var(--text-color);
    }
    .input-field:focus, .select-field:focus {
        outline: none; border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.25), 0 0 8px rgba(56, 189, 248, 0.3); /* Enhanced glow */
    }
    .input-field::placeholder { color: #9ca3af;}
    label { font-size: 0.875rem; font-weight: 500; color: var(--text-light-color); margin-bottom: 0.25rem; display: block;}
    .form-group { margin-bottom: 1.25rem;}

    .location-type-toggle button {
        padding: 0.5rem 1rem; border: 1px solid var(--border-color); color: var(--text-light-color);
        background-color: var(--input-bg-color); transition: all 0.2s ease;
        position: relative; overflow: hidden; /* For ripple */
    }
    .location-type-toggle button:first-child { border-top-left-radius: var(--input-border-radius); border-bottom-left-radius: var(--input-border-radius); border-right-width: 0.5px;}
    .location-type-toggle button:last-child { border-top-right-radius: var(--input-border-radius); border-bottom-right-radius: var(--input-border-radius); border-left-width: 0.5px;}
    .location-type-toggle button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); z-index: 10; }
    .location-type-toggle button:not(.active):hover { background-color: #e0f2fe; color: var(--primary-dark-color); }


    #drink-search-input {padding-left: 2.5rem;}
    .search-icon-wrapper { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--text-light-color); transition: color 0.2s ease;}
    #drink-search-input:focus + .search-icon-wrapper i { color: var(--primary-color); }


    /* Cart Icon Badge */
    .cart-badge {
        position: absolute; top: -8px; right: -8px; background-color: #ef4444; /* red-500 */
        color: white; border-radius: 50%; padding: 0.15rem 0.4rem;
        font-size: 0.7rem; font-weight: bold; line-height: 1; display: flex;
        align-items: center; justify-content: center; min-width: 18px; height: 18px;
        transform-origin: center center;
    }
    .cart-badge.updated { /* Class to add when cart updates */
        animation: badgePop 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }
    @keyframes badgePop {
        0% { transform: scale(1); }
        50% { transform: scale(1.3); }
        100% { transform: scale(1); }
    }

     /* Cart View Modal */
    #cart-view-modal .modal-content {
        max-width: 600px; /* Wider for cart items */
    }
    .cart-view-item {
        display: flex; align-items: center; justify-content: space-between;
        padding: 0.75rem 0; border-bottom: 1px solid var(--border-color);
        transition: background-color 0.2s ease;
    }
    .cart-view-item:hover { background-color: #f8fafc; /* slate-50 */ }
    .cart-view-item:last-child { border-bottom: none; }
    .cart-view-item-details { flex-grow: 1; margin-left: 1rem; }
    .cart-view-item-details h5 { font-weight: 600; color: var(--text-color); }
    .cart-view-item-details p { font-size: 0.875rem; color: var(--text-light-color); }
    .cart-view-item-quantity button {
        background: var(--secondary-color); border: 1px solid var(--border-color);
        color: var(--text-color); width: 28px; height: 28px; border-radius: 50%;
        font-weight: bold; cursor: pointer; transition: background-color 0.2s, transform 0.1s;
    }
    .cart-view-item-quantity button:hover { background-color: var(--border-color); transform: scale(1.1); }
    .cart-view-item-quantity button:active { transform: scale(0.95); }
    .cart-view-item-quantity span { margin: 0 0.5rem; font-weight: 500; }
    .cart-view-item-price { font-weight: 600; color: var(--primary-dark-color); }

    /* Scroll-triggered animations */
    .animate-on-scroll {
      opacity: 0;
      transform: translateY(40px); /* Start further down */
      transition: opacity 0.65s ease-out, transform 0.65s cubic-bezier(0.25, 0.8, 0.25, 1); /* Smoother ease */
    }
    .animate-on-scroll.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    /* Staggered animation for children of an observed parent */
    .stagger-children > * {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    }
    .stagger-children.is-visible > * {
      opacity: 1;
      transform: translateY(0);
    }
    /* Example: apply to a grid of cards. Each card is a child. */
    .stagger-children.is-visible > *:nth-child(1) { transition-delay: 0.1s; }
    .stagger-children.is-visible > *:nth-child(2) { transition-delay: 0.2s; }
    .stagger-children.is-visible > *:nth-child(3) { transition-delay: 0.3s; }
    .stagger-children.is-visible > *:nth-child(4) { transition-delay: 0.4s; } /* etc. */


    @media (max-width:1024px){.card,.modal-content{border-radius:.75rem !important;}}
    @media (max-width:900px){footer{font-size:90%;}}
    @media (max-width: 768px) {
      .hero-text { text-align: center; }
      .nav-links-desktop { display: none; }
      .mobile-menu-button { display: block; } /* Ensure cart icon is also handled for mobile */
      main { padding-top: 4.5rem; }
      .why-us-card{padding:1.25rem;}
      .card,.modal-content{border-radius:.5rem;}
    }
    @media (max-width: 540px){
      .why-us-card{padding:.85rem;}
      .product-card .p-5{padding:1rem;}
      .modal-content{padding:1rem;}
      .card{padding:1rem;}
      .form-group{margin-bottom:1rem;}
    }
    @media (max-width: 420px){
      .why-us-card{padding:.5rem;}
      .modal-content{padding:.85rem;}
      .product-card .p-5{padding:.5rem;}
    }
    @media (max-width: 370px){
      .why-us-card,.product-card .p-5,.card,.modal-content{padding:0.3rem;}
    }
    @media (min-width: 769px) {.mobile-menu-button { display: none;} .nav-links-desktop { display: flex; } }

    #promo-banner {
      display:none;
      animation: fadein .5s;
    }
    .flash-notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: var(--primary-dark-color);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--input-border-radius);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 2000;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        opacity: 0;
        transform: translateY(20px) scale(0.95); /* Added scale for pop */
        transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Bouncy transition */
    }
    .flash-notification.show {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    .flash-notification.hide {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    @keyframes fadein{
      0%{opacity:0;transform:translateY(-15px);}
      100%{opacity:1;transform:translateY(0);}
    }
    .animate__fadeInDown{
      animation:fadein .9s;
    }
    .animate__fadeInUp{
      animation:fadeInUp .7s;
    }
    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(16px);}
      to{opacity:1;transform:translateY(0);}
    }

    /* Chat Widget */
    #chat-widget {
        /* ... existing styles ... */
        animation: chatWidgetPulse 2.5s infinite cubic-bezier(0.68, -0.55, 0.27, 1.55) 1s; /* Start after 1s */
    }
    @keyframes chatWidgetPulse {
        0%, 100% { transform: scale(1.1); box-shadow: 0 0 0 0 rgba(2, 132, 199, 0.6); } /* sky-600 */
        50% { transform: scale(1.2); box-shadow: 0 0 0 12px rgba(2, 132, 199, 0); }
    }
    #chat-widget:hover {
        animation-play-state: paused;
        transform: scale(1.25) rotate(10deg); /* Added rotate */
        background-color: var(--primary-hover-color);
    }
  </style>
</head>
<body class="bg-slate-100 font-inter"> <!-- Original bg-slate-100, will be overridden by body style if needed -->
<header class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="#" class="text-2xl font-bold text-[var(--primary-dark-color)] flex items-center" onclick="showSection('home')">
                        <i class="fas fa-glass-water mr-2 text-sky-500 text-3xl"></i>
                        <span>HotelDrinks</span>
                    </a>
                </div>
                <nav class="hidden md:flex items-center space-x-1 nav-links-desktop">
                    <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600 active" onclick="setActiveLink(this); showSection('home')">Home</a>
                    <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="setActiveLink(this); showSection('order')">Order Now</a>
                    <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="setActiveLink(this); showSection('how-it-works')">How It Works</a>
                    <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="setActiveLink(this); showSection('vendor-signup')">Become a Vendor</a>
                    <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="setActiveLink(this); showSection('contact')">Contact Us</a>
                    <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="setActiveLink(this); showSection('faq')">FAQ</a>

                    <!-- Desktop Cart Icon -->
                    <div id="cart-icon-desktop" class="relative ml-4 cursor-pointer text-slate-700 hover:text-sky-600" onclick="toggleCartView()">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cart-count-badge-desktop" class="cart-badge hidden">0</span>
                    </div>

                    <div id="auth-links-desktop" class="flex items-center space-x-2 ml-2">
                        <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="setActiveLink(this); showSection('login')">Login</a>
                        <a href="#" class="btn btn-primary text-sm py-1.5 px-3" onclick="setActiveLink(this); showSection('register')">Sign Up</a>
                    </div>
                    <div id="user-actions-desktop" class="hidden items-center space-x-2 ml-2">
                        <span id="welcome-user-desktop" class="text-sm font-medium text-slate-700"></span>
                        <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-slate-700 hover:text-sky-600" onclick="logoutUser()">Logout</a>
                    </div>
                </nav>
                <div class="md:hidden flex items-center">
                     <!-- Mobile Cart Icon -->
                     <div id="cart-icon-mobile" class="relative mr-4 cursor-pointer text-slate-700 hover:text-sky-600" onclick="toggleCartView()">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cart-count-badge-mobile" class="cart-badge hidden">0</span>
                    </div>
                    <button id="mobile-menu-button" class="text-slate-700 hover:text-sky-600 focus:outline-none focus:text-sky-600">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden bg-white shadow-lg border-t border-slate-200">
            <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('home'); toggleMobileMenu();">Home</a>
            <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('order'); toggleMobileMenu();">Order Now</a>
            <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('how-it-works'); toggleMobileMenu();">How It Works</a>
            <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('vendor-signup'); toggleMobileMenu();">Become a Vendor</a>
            <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('contact'); toggleMobileMenu();">Contact Us</a>
            <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('faq'); toggleMobileMenu();">FAQ</a>
            <div id="auth-links-mobile" class="border-t border-slate-200 mt-2 pt-2">
                <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="setActiveLink(this, true); showSection('login'); toggleMobileMenu();">Login</a>
                <a href="#" class="block px-4 py-3 text-base text-sky-600 font-semibold hover:bg-sky-50" onclick="setActiveLink(this, true); showSection('register'); toggleMobileMenu();">Sign Up</a>
            </div>
            <div id="user-actions-mobile" class="hidden border-t border-slate-200 mt-2 pt-2">
                 <span id="welcome-user-mobile" class="block px-4 py-3 text-base font-medium text-slate-700"></span>
                <a href="#" class="block px-4 py-3 text-base text-slate-700 hover:bg-sky-50 hover:text-sky-600" onclick="logoutUser(); toggleMobileMenu();">Logout</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24">
        <!-- Sections remain the same -->
        <section id="home" class="page-section">
            <!-- Added .hero-gradient-animated class here -->
            <div id="hero-bg" class="hero-gradient-animated rounded-xl shadow-2xl overflow-hidden text-white">
                <div class="md:flex">
                    <div class="md:w-1/2 p-8 md:p-16 flex flex-col justify-center hero-text">
                        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold mb-6 leading-tight">Hotel Drinks are Expensive</h1>
                        <h2 class="text-xl sm:text-2xl text-sky-100 mb-8">
  <span id="typewriter"></span>
</h2>
                        <button class="btn bg-white text-sky-600 hover:bg-sky-50 font-semibold py-3 px-10 rounded-lg text-lg shadow-lg hover:shadow-xl transform transition-all duration-300 self-start md:self-auto" onclick="showSection('order'); setActiveLink(document.querySelector('.nav-link[onclick*=\'order\']'));">
                            Order Now <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                        <br>
                        <p class="text-xl sm:text-2xl text-sky-100 mb-8">Delivered to Your Hotel or Apartment in Minutes!</p>
                    </div>
                    <div class="md:w-1/2 h-72 md:h-auto hero-image-container">
                        <img id="heroImageSlideshow" src="https://static.wixstatic.com/media/cfe6d1_84a78396f22b49dd86d14c247efae6c0~mv2.png" alt="Drinks delivered to room" class="active">
                        <!-- Additional images for slideshow will be populated by JS if logic exists, or add them manually -->
                    </div>
                </div>
            </div>
            <section class="py-16 md:py-20">
                <h2 class="text-3xl md:text-4xl font-bold text-[var(--primary-dark-color)] mb-12 text-center animate-on-scroll">Why Choose HotelDrinks?</h2>
                <!-- Added stagger-children for card animation -->
                <div class="grid md:grid-cols-3 gap-8 stagger-children">
                    <div class="why-us-card"><i class="fas fa-tags"></i><h3 class="text-xl font-semibold text-slate-700 mb-2">Smarter Prices</h3><p class="text-slate-600">Hotel Mini-Bar: ~₦2,000. Our Price: ~₦1,000. Enjoy significant savings!</p></div>
                    <div class="why-us-card"><i class="fas fa-bolt-lightning"></i><h3 class="text-xl font-semibold text-slate-700 mb-2">Lightning Fast</h3><p class="text-slate-600">Delivery in <span class="font-bold">around 5 minutes</span> to nearby locations. We're swift!</p></div>
                    <div class="why-us-card"><i class="fas fa-map-pin"></i><h3 class="text-xl font-semibold text-slate-700 mb-2">Ultimate Convenience</h3><p class="text-slate-600">Order from anywhere, to your hotel or apartment. We deliver nationwide.</p></div>
                </div>
                 <div id="social-proof-display" class="text-center mt-12 animate-on-scroll"></div>
            </section>
        </section>

        <section id="order" class="page-section hidden">
            <div class="card p-6 md:p-8 animate-on-scroll">
                <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-8 text-center">Place Your Order</h2>

                <div id="location-selection-step" class="order-step mb-8 p-6 bg-slate-50 rounded-lg border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-700 mb-4">Step 1: Where are you?</h3>
                    <div class="location-type-toggle flex mb-4">
                        <button id="select-hotel-type-btn" class="flex-1 active" onclick="toggleLocationType('hotel')"><i class="fas fa-hotel mr-2"></i>Hotel</button>
                        <button id="select-apartment-type-btn" class="flex-1" onclick="toggleLocationType('apartment')"><i class="fas fa-building mr-2"></i>Apartment/Address</button>
                    </div>

                    <div id="hotel-selection-content">
                        <p class="text-sm text-slate-500 mb-4">Find your hotel on the map or list. We can also try to auto-detect your location.</p>
                        <div id="hotel-list" class="space-y-2 max-h-48 overflow-y-auto mb-4"></div>
                        <p id="selected-hotel-info" class="text-slate-700 font-medium mb-4">Selected Hotel: <span class="text-sky-600">None</span></p>
                    </div>

                    <div id="apartment-address-content" class="hidden">
                        <p class="text-sm text-slate-500 mb-4">Enter your delivery address. We'll try to auto-fill State/City if location access is granted.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="form-group">
                                <label for="apartment-state">State</label>
                                <select id="apartment-state" class="select-field"></select>
                            </div>
                            <div class="form-group">
                                <label for="apartment-city">City/Town</label>
                                <select id="apartment-city" class="select-field" disabled></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="apartment-street-address">Street Address & Apartment No.</label>
                            <input type="text" id="apartment-street-address" class="input-field" placeholder="e.g., 123 Main St, Apt 4B">
                        </div>
                         <p id="entered-address-info" class="text-slate-700 font-medium mb-4 hidden">Address: <span class="text-sky-600"></span></p>
                    </div>
                    <div id="map-container-common" class="mt-4"> <div id="map"></div>
                    </div>
                    <button id="proceed-to-products-btn" type="button" onclick="proceedToProducts()" class="w-full btn btn-primary font-semibold py-2.5 mt-6" disabled>Next: Browse Drinks</button>
                </div>

                <div id="product-browsing-step" class="order-step hidden mb-8">
                    <h3 class="text-xl font-semibold text-slate-700 mb-1">Step 2: Browse Drinks</h3>
                    <div class="my-4 relative">
                        <input type="search" id="drink-search-input" class="input-field w-full" placeholder="Search for drinks...">
                        <div class="search-icon-wrapper"><i class="fas fa-search"></i></div>
                    </div>
                    <p class="text-slate-500 mb-4">Select your desired beverages from the categories below.</p>
                    <div class="flex space-x-2 mb-6 overflow-x-auto pb-2">
                        <button class="category-btn active bg-sky-500 text-white px-4 py-2 rounded-full text-sm font-medium btn" onclick="filterProducts('all', this)">All</button>
                        <button class="category-btn bg-slate-200 text-slate-700 hover:bg-sky-100 px-4 py-2 rounded-full text-sm font-medium btn" onclick="filterProducts('water', this)">Water</button>
                        <button class="category-btn bg-slate-200 text-slate-700 hover:bg-sky-100 px-4 py-2 rounded-full text-sm font-medium btn" onclick="filterProducts('softdrinks', this)">Soft Drinks</button>
                        <button class="category-btn bg-slate-200 text-slate-700 hover:bg-sky-100 px-4 py-2 rounded-full text-sm font-medium btn" onclick="filterProducts('alcoholic', this)">Beer & Wine</button>
                        <button class="category-btn bg-slate-200 text-slate-700 hover:bg-sky-100 px-4 py-2 rounded-full text-sm font-medium btn" onclick="filterProducts('spirits', this)">Spirits</button>
                        <button class="category-btn bg-slate-200 text-slate-700 hover:bg-sky-100 px-4 py-2 rounded-full text-sm font-medium btn" onclick="filterProducts('mixers', this)">Mixers</button>
                    </div>
                    <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 stagger-children"></div>
                    <button onclick="proceedToCartReview()" class="w-full btn btn-primary font-semibold py-3 mt-8 text-lg">Review Cart & Checkout</button>
                </div>

                <div id="cart-review-step" class="order-step hidden mb-8">
                    <h3 class="text-xl font-semibold text-slate-700 mb-6">Step 3: Review Your Cart & Confirm Details</h3>
                    <div id="cart-items-review" class="space-y-4 mb-6">
                        <p id="empty-cart-message-review" class="text-slate-500">Your cart is currently empty.</p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-lg mb-6">
                        <div class="flex justify-between items-center mb-2"><span class="text-slate-600">Subtotal:</span><span id="cart-subtotal-review" class="font-semibold text-slate-800">₦0</span></div>
                        <div class="flex justify-between items-center mb-2"><span class="text-slate-600">Delivery Fee:</span><span id="delivery-fee-review" class="font-semibold text-slate-800">₦0</span></div>
                        <div class="flex justify-between items-center mb-4 text-lg font-bold text-[var(--primary-dark-color)]"><span>Total:</span><span id="cart-total-review">₦0</span></div>
                    </div>

                    <div id="guest-details-checkout" class="p-6 bg-slate-50 rounded-lg border border-slate-200">
                        <h4 class="text-lg font-semibold text-slate-700 mb-4">Guest Details for Delivery</h4>
                        <form id="guest-checkout-form" class="space-y-5">
                            <div class="form-group"><label for="checkout-room-number">Room Number / Apt No.</label><input type="text" id="checkout-room-number" name="room-number" required class="input-field" placeholder="e.g., 305 or Apt 4B"></div>
                            <div class="form-group"><label for="checkout-guest-name">Your Name</label><input type="text" id="checkout-guest-name" name="guest-name" required class="input-field" placeholder="Full Name"></div>
                            <div class="form-group">
                                <label for="checkout-phone-number">Phone Number</label>
                                <input type="tel" id="checkout-phone-number" name="phone-number" class="input-field" placeholder="08012345678" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                            </div>
                        </form>
                    </div>
                     <div class="mt-6 form-group">
                        <label for="payment-method">Payment Method</label>
                        <select id="payment-method" name="payment-method" class="select-field">
                            <option>Credit/Debit Card (Online - Mock)</option>
                            <option>Mobile Wallet (Online - Mock)</option>
                            <option selected>Cash on Delivery</option>
                        </select>
                    </div>
                    <button onclick="confirmAndPlaceOrder()" class="w-full btn btn-primary font-semibold py-3 mt-8 text-lg">Confirm & Place Order</button>
                </div>

                <div id="order-confirmation-step" class="order-step hidden py-10">
                    <!-- Content will be injected by JS -->
                </div>

                <div id="rating-review-step" class="order-step hidden py-10">
                     <h3 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-8 text-center">Rate Your Experience</h3>
                    <div class="max-w-md mx-auto card p-8">
                        <p class="text-slate-600 mb-6 text-center text-lg">Order <strong id="rating-order-id" class="text-sky-700">#HOD12345</strong>. How was our service?</p>
                        <div class="star-rating flex justify-center space-x-1 mb-8">
                            <i class="fas fa-star" data-value="1"></i><i class="fas fa-star" data-value="2"></i><i class="fas fa-star" data-value="3"></i><i class="fas fa-star" data-value="4"></i><i class="fas fa-star" data-value="5"></i>
                        </div>
                        <input type="hidden" id="selected-rating" value="0">
                        <div class="form-group">
                            <label for="review-text">Leave a review (optional):</label>
                            <textarea id="review-text" rows="4" class="input-field" placeholder="Tell us more... e.g., Super fast delivery! Drinks were perfectly chilled."></textarea>
                        </div>
                        <button onclick="submitRatingReview()" class="w-full btn btn-primary font-semibold py-2.5 mt-6">Submit Feedback</button>
                    </div>
                </div>
            </div>
        </section>

         <section id="login" class="page-section hidden">
            <div class="max-w-md mx-auto mt-12 card p-8 md:p-10 animate-on-scroll">
                <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-8 text-center">Welcome Back!</h2>
                <form id="login-form" class="space-y-6">
                    <div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" required class="input-field" placeholder="you@example.com"></div>
                    <div class="form-group"><label for="login-password">Password</label><input type="password" id="login-password" required class="input-field" placeholder="••••••••"></div>
                    <button type="button" onclick="handleLogin()" class="w-full btn btn-primary font-semibold py-3">Login</button>
                </form>
                <p class="mt-8 text-center text-sm text-slate-600">Don't have an account? <a href="#" class="font-medium text-sky-600 hover:text-sky-500" onclick="showSection('register'); setActiveLink(document.querySelector('.nav-link[onclick*=\'register\']'));">Sign up</a></p>
            </div>
        </section>

        <section id="register" class="page-section hidden">
           <div class="max-w-md mx-auto mt-12 card p-8 md:p-10 animate-on-scroll">
                <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-8 text-center">Create Your Account</h2>
                <form id="register-form" class="space-y-6">
                    <div class="form-group"><label for="register-name">Full Name</label><input type="text" id="register-name" required class="input-field" placeholder="Your Full Name"></div>
                    <div class="form-group"><label for="register-email">Email</label><input type="email" id="register-email" required class="input-field" placeholder="you@example.com"></div>
                    <div class="form-group">
                        <label for="register-phone">Phone (Optional)</label>
                        <input type="tel" id="register-phone" class="input-field" placeholder="08012345678" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                    </div>
                    <div class="form-group"><label for="register-password">Password</label><input type="password" id="register-password" required class="input-field" placeholder="Choose a strong password"></div>
                    <button type="button" onclick="handleRegistration()" class="w-full btn btn-primary font-semibold py-3">Create Account</button>
                </form>
                <p class="mt-8 text-center text-sm text-slate-600">Already have an account? <a href="#" class="font-medium text-sky-600 hover:text-sky-500" onclick="showSection('login'); setActiveLink(document.querySelector('.nav-link[onclick*=\'login\']'));">Login</a></p>
            </div>
        </section>

        <section id="vendor-signup" class="page-section hidden card p-6 md:p-8 animate-on-scroll">
            <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-8 text-center">Become a Vendor Partner</h2>
            <div class="max-w-xl mx-auto">
                <p class="text-slate-600 mb-8 text-center leading-relaxed">Partner with HotelDrinks to expand your reach! Supply drinks to hotels and apartments in your area. We provide the platform, you manage stock and local delivery. Let's grow together, nationwide!</p>
                <form id="vendor-signup-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-group"><label for="vendor-name">Business Name</label><input type="text" id="vendor-name" required class="input-field"></div>
                        <div class="form-group"><label for="vendor-contact-person">Contact Person</label><input type="text" id="vendor-contact-person" required class="input-field"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-group"><label for="vendor-email">Business Email</label><input type="email" id="vendor-email" required class="input-field"></div>
                        <div class="form-group">
                            <label for="vendor-phone">Business Phone</label>
                            <input type="tel" id="vendor-phone" required class="input-field" placeholder="08012345678" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                        </div>
                    </div>
                    <div class="form-group"><label for="vendor-address">Business Address / Primary Area of Operation</label><textarea id="vendor-address" rows="3" class="input-field" placeholder="e.g., Wuse Zone 2, Abuja OR Ikeja GRA, Lagos"></textarea></div>
                    <p class="text-sm text-slate-500">Submitting this form expresses your interest. Our team will contact you with more details.</p>
                    <button type="button" onclick="handleVendorSignup()" class="w-full btn btn-primary font-semibold py-3">Submit Interest</button>
                </form>
            </div>
        </section>

        <section id="how-it-works" class="page-section hidden card p-6 md:p-8 animate-on-scroll">
            <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-10 text-center">Simple Steps to Refreshment</h2>
            <div class="grid md:grid-cols-5 gap-x-6 gap-y-8 text-center stagger-children"> <!-- Added stagger-children -->
                 <div class="flex flex-col items-center p-3"><div class="bg-sky-100 text-sky-600 rounded-full w-20 h-20 flex items-center justify-center mb-4 text-3xl shadow-md"><i class="fas fa-user-check"></i></div><h3 class="text-lg font-semibold text-slate-700 mb-1">1. Login/Sign Up</h3><p class="text-sm text-slate-600">(Optional) For saved details & faster orders.</p></div>
                 <div class="flex flex-col items-center p-3"><div class="bg-sky-100 text-sky-600 rounded-full w-20 h-20 flex items-center justify-center mb-4 text-3xl shadow-md"><i class="fas fa-map-location-dot"></i></div><h3 class="text-lg font-semibold text-slate-700 mb-1">2. Set Location</h3><p class="text-sm text-slate-600">Select hotel or enter your apartment address.</p></div>
                 <div class="flex flex-col items-center p-3"><div class="bg-sky-100 text-sky-600 rounded-full w-20 h-20 flex items-center justify-center mb-4 text-3xl shadow-md"><i class="fas fa-martini-glass"></i></div><h3 class="text-lg font-semibold text-slate-700 mb-1">3. Pick Drinks</h3><p class="text-sm text-slate-600">Browse our wide selection & add to cart.</p></div>
                 <div class="flex flex-col items-center p-3"><div class="bg-sky-100 text-sky-600 rounded-full w-20 h-20 flex items-center justify-center mb-4 text-3xl shadow-md"><i class="fas fa-credit-card"></i></div><h3 class="text-lg font-semibold text-slate-700 mb-1">4. Checkout</h3><p class="text-sm text-slate-600">Confirm details, room/apt no. & pay.</p></div>
                 <div class="flex flex-col items-center p-3"><div class="bg-sky-100 text-sky-600 rounded-full w-20 h-20 flex items-center justify-center mb-4 text-3xl shadow-md"><i class="fas fa-rocket"></i></div><h3 class="text-lg font-semibold text-slate-700 mb-1">5. Speedy Delivery</h3><p class="text-sm text-slate-600">Drinks at your door in ~5 mins!</p></div>
            </div>
        </section>

        <section id="contact" class="page-section hidden card p-6 md:p-8 animate-on-scroll">
            <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-8 text-center">Get In Touch</h2>
            <div class="max-w-lg mx-auto">
                <p class="text-slate-600 mb-8 text-center">Questions, feedback, or complaints? We're here to help!</p>
                <form id="contact-form" class="space-y-6">
                    <div class="form-group">
                        <label for="contact-inquiry-type">Nature of Inquiry</label>
                        <select id="contact-inquiry-type" name="inquiry-type" class="select-field">
                            <option value="general">General Question</option>
                            <option value="feedback">Feedback</option>
                            <option value="complaint">Complaint</option>
                            <option value="support">Order Support</option>
                            <option value="vendor">Vendor Inquiry</option>
                        </select>
                    </div>
                     <div id="contact-order-id-group" class="hidden form-group">
                        <label for="contact-order-id">Order ID (if applicable)</label>
                        <input type="text" name="contact-order-id" id="contact-order-id" class="input-field" placeholder="e.g., HOD12345">
                    </div>
                    <div class="form-group"><label for="contact-name">Full Name</label><input type="text" name="contact-name" id="contact-name" required class="input-field"></div>
                    <div class="form-group"><label for="contact-email">Email Address</label><input type="email" name="contact-email" id="contact-email" required class="input-field"></div>
                    <div class="form-group"><label for="contact-message">Message</label><textarea id="contact-message" name="contact-message" rows="4" required class="input-field"></textarea></div>
                    <div><button type="button" onclick="handleContactSubmit()" class="w-full btn btn-primary font-semibold py-3">Send Message</button></div>
                </form>
            </div>
        </section>

        <section id="faq" class="page-section hidden card p-6 md:p-8 animate-on-scroll">
            <h2 class="text-3xl font-bold text-[var(--primary-dark-color)] mb-10 text-center">Frequently Asked Questions</h2>
            <div class="space-y-8 max-w-2xl mx-auto">
                <div class="animate-on-scroll"><h3 class="font-semibold text-slate-800 text-lg mb-1">Do I need an account to order?</h3><p class="text-slate-600 leading-relaxed">No, you can checkout as a guest. Creating an account is quick and allows for faster checkouts in the future by saving your details (mocked for this demo).</p></div>
                <div class="animate-on-scroll"><h3 class="font-semibold text-slate-800 text-lg mb-1">What locations do you serve?</h3><p class="text-slate-600 leading-relaxed">We are a nationwide service! Our platform connects you with local vendors near your hotel or apartment across the country. Delivery times and availability may vary based on local vendor coverage.</p></div>
                <div class="animate-on-scroll"><h3 class="font-semibold text-slate-800 text-lg mb-1">How does delivery to apartments work?</h3><p class="text-slate-600 leading-relaxed">Simply select "Apartment/Address" during the order process and enter your full address (State, City, Street). We'll match you with the nearest available vendor. Ensure your address details are accurate for smooth delivery.</p></div>
                <div class="animate-on-scroll"><h3 class="font-semibold text-slate-800 text-lg mb-1">How fast is delivery?</h3><p class="text-slate-600 leading-relaxed">For nearby locations with active vendors, we aim for delivery in approximately 5 minutes! This can vary based on demand and distance.</p></div>
                <div class="animate-on-scroll"><h3 class="font-semibold text-slate-800 text-lg mb-1">How does the vendor system work?</h3><p class="text-slate-600 leading-relaxed">Local businesses can partner with us as vendors. They list their drink products and manage inventory for their service area. When you place an order, our system (conceptually) routes it to the closest vendor who can fulfill it quickly.</p></div>
            </div>
        </section>
    </main>

<div id="promo-banner" class="fixed top-20 left-1/2 z-30 -translate-x-1/2 bg-sky-700 text-white px-5 py-2 rounded shadow-lg flex items-center space-x-3 animate__animated animate__fadeInDown min-w-[280px] max-w-[98vw]">
  <i class="fas fa-gift"></i>
  <span id="promo-msg"></span>
  <span id="promo-timer" class="font-bold ml-2"></span>
</div>

<footer class="bg-slate-900 text-slate-400 py-10 mt-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p>&copy; <span id="currentYear"></span> HotelDrinks On Demand. All rights reserved.</p>
        <p class="text-sm mt-1">Fast, Affordable Drinks Delivered Nationwide.</p>
        <div class="mt-4 space-x-4">
            <a href="#" class="hover:text-sky-400 transition-colors">Privacy Policy</a>
            <a href="#" class="hover:text-sky-400 transition-colors">Terms of Service</a>
            <a href="#" class="hover:text-sky-400 transition-colors" onclick="showSection('contact')">Support</a>
        </div>
    </div>
</footer>

<div id="chat-widget" class="fixed bottom-6 right-6 bg-sky-500 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-xl cursor-pointer hover:bg-sky-600 transition-all duration-300 transform hover:scale-110"> <i class="fas fa-comment-dots text-2xl"></i></div>
<div id="messageModal" class="modal"><div class="modal-content"><span class="modal-close" onclick="closeModal()">&times;</span><p id="modalMessageText" class="text-slate-700 text-lg"></p><button class="btn btn-primary mt-6 py-2 px-6" onclick="closeModal()">OK</button></div></div>

<!-- Cart View Modal -->
<div id="cart-view-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="toggleCartView()">&times;</span>
        <h3 class="text-2xl font-bold text-[var(--primary-dark-color)] mb-6 text-center">Your Cart</h3>
        <div id="cart-view-items-container" class="max-h-[60vh] overflow-y-auto mb-6">
            <!-- Cart items will be injected here by JS -->
            <p id="cart-view-empty-msg" class="text-slate-500 text-center py-4">Your cart is empty.</p>
        </div>
        <div class="border-t border-slate-200 pt-4">
            <div class="flex justify-between items-center mb-4">
                <span class="text-lg font-semibold text-slate-700">Subtotal:</span>
                <span id="cart-view-subtotal" class="text-lg font-bold text-[var(--primary-dark-color)]">₦0</span>
            </div>
            <div class="flex space-x-2">
                <button onclick="clearCart()" class="btn btn-secondary flex-1 py-2.5">Clear Cart</button>
                <button id="cart-view-checkout-btn" onclick="proceedToCheckoutFromCartView()" class="btn btn-primary flex-1 py-2.5">Proceed to Checkout</button>
            </div>
        </div>
    </div>
</div>


<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<script>
// --- START OF JS ---
/**************************************************
 * MOCKED "BACKEND" ORDER QUEUE, STATUS, ACTIVITY *
 **************************************************/
// ... (Existing mock backend code: orderQueue, queueListeners, etc. remains here) ...
// Simulated Queue, Order, Activity, Promotions (global, but can be module-split)
let orderQueue = [];
let queueListeners = [];
let deliveryStatusListeners = [];
let currentOrderLocal = null; // Represents the user's current order being tracked by this mock backend

// Social Proof
const mostPopularDrink = 'Smirnoff Vodka';
let purchaseStats = {count: 0, lastHour: 20};

// Promo Offers
const promoOffers = [
  { msg: "🔥 5% discount! Complete checkout in", seconds: 300 },
  { msg: "🎉 Fastest Delivery: Most orders under 5 minutes!", seconds: 0 },
  { msg: "🚚 Orders placed now qualify for speedy delivery!", seconds: 0 }
];

// ========== FLASH ACTIVITY MESSAGES (e.g. "Guest bought drinks") ==========
function showFlashActivityMessage(message, icon = "fa-bolt", duration = 3000) {
  const flashDiv = document.createElement('div');
  flashDiv.className = 'flash-notification';
  flashDiv.innerHTML = `<i class="fas ${icon} text-sky-300"></i><span>${message}</span>`;
  document.body.appendChild(flashDiv);
  setTimeout(() => { flashDiv.classList.add('show'); }, 10);
  setTimeout(() => {
    flashDiv.classList.remove('show');
    flashDiv.classList.add('hide');
    setTimeout(() => { flashDiv.remove(); }, 500);
  }, duration);
}

setInterval(() => {
    const samples = [
      "A guest just bought 3 drinks", "A guest just bought 6 JD Black Barrel", "A guest just bought 12 Smirnoff",
      "A guest just got fast delivery at Transcorp!", "A guest just got a bottle of Heineken",
      "A guest just ordered Red Wine (Carlo Rossi Mini)", "A guest just picked up Schweppes Lemonade"
    ];
    showFlashActivityMessage(samples[Math.floor(Math.random() * samples.length)]);
}, 20000);

// ========== PROMO BANNER & TIMER ==========
let promoTimeout, promoTimerInt, promoOfferIdx = 0;
function showPromoBanner() {
  const banner = document.getElementById('promo-banner');
  if (!banner) return;
  const msg = document.getElementById('promo-msg');
  const timer = document.getElementById('promo-timer');
  const offer = promoOffers[promoOfferIdx % promoOffers.length];
  banner.style.display = 'flex';
  msg.textContent = offer.msg;
  if (offer.seconds > 0) {
    let t = offer.seconds;
    timer.textContent = formatSeconds(t);
    promoTimerInt && clearInterval(promoTimerInt);
    promoTimerInt = setInterval(() => {
      t--;
      timer.textContent = formatSeconds(t);
      if (t<=0) { clearInterval(promoTimerInt); setTimeout(()=> { promoOfferIdx++; showPromoBanner(); }, 1500); }
    }, 1000);
  } else {
    timer.textContent = '';
    promoTimeout && clearTimeout(promoTimeout);
    promoTimeout = setTimeout(()=>{ promoOfferIdx++; showPromoBanner(); }, 7000);
  }
}
function formatSeconds(t) { let m = Math.floor(t/60), s = t%60; return `${m}:${s<10?'0':''}${s}`; }

// ========== SOCIAL PROOF (Summary Messages) ==========
function updateSocialProof() {
  const proofPlace = document.getElementById("social-proof-display");
  if (!proofPlace) return;
  let proofMsg = '';
  const now = new Date(), min = now.getMinutes();
  if (min % 4 === 0 || min%4===1)
    proofMsg = `<div class="my-1 w-full max-w-md mx-auto px-3 py-1.5 bg-green-50 text-green-700 font-medium rounded text-sm">🍹 ${purchaseStats.lastHour} guests have ordered drinks in the last hour!</div>`;
  else
    proofMsg = `<div class="my-1 w-full max-w-md mx-auto px-3 py-1.5 bg-yellow-50 text-yellow-700 font-medium rounded text-sm">✨ Most popular choice now: <span class="font-bold">${mostPopularDrink}</span>!</div>`;
  proofPlace.innerHTML = proofMsg;
}
setInterval(updateSocialProof, 180000);

// ========== ORDER QUEUE + DELIVERY TRACKING (for the user's current order) ==========
function postMockOrder(order) {
  order.queueNum = orderQueue.length+1; order.status = 'Preparing'; order.timePlaced = Date.now();
  order.deliveryProgress = 0; order.deliveryStatus = 'Preparing';
  order.driver = {lat: 6.5871, lng: 3.3705, heading: 68};
  order.eta = 300 + Math.floor(Math.random()*60);
  order.deliveryStarted = false; order._intervals = {};
  orderQueue.push(order);
  purchaseStats.count++; purchaseStats.lastHour += Math.floor(Math.random()*2);
  notifyOrderQueueUpdated(); return order;
}
function getOrderQueuePosition(orderId) { let idx = orderQueue.findIndex(o=>o.orderId===orderId); return idx === -1 ? null : idx+1; }
function advanceOrderQueue() {
  if (orderQueue.length > 0) {
    let o = orderQueue[0];
    if (o.status==='Preparing') { o.status = 'Out for Delivery'; o.deliveryStatus = 'En Route'; o.deliveryStarted = Date.now(); }
    else if (o.status==='Out for Delivery') {
      if(Date.now() > o.timePlaced + (o.eta * 1000)) {
        o.status = 'Delivered'; o.deliveryStatus = 'Delivered'; o.deliveryProgress = 100;
        setTimeout(()=> { orderQueue.shift(); notifyOrderQueueUpdated(); }, 5000);
      }
    }
    notifyOrderQueueUpdated();
  }
}
setInterval(advanceOrderQueue, 12000);
function notifyOrderQueueUpdated() { queueListeners.forEach(cb=>cb()); deliveryStatusListeners.forEach(cb=>cb()); }
function subscribeOrderQueue(cb) { queueListeners.push(cb); }
function subscribeDeliveryStatus(cb) { deliveryStatusListeners.push(cb); }
function setupOrderStatusUI(order) {
  const queueNumEl = document.getElementById('queue-num'); const queuePosEl = document.getElementById('queue-pos');
  const queueStatusEl = document.getElementById('queue-status'); const deliveryStatusEl = document.getElementById('delivery-status');
  const deliveryEtaEl = document.getElementById('delivery-eta'); const progressBar = document.getElementById('progress-bar');
  function updateStatus() {
    if (!currentOrderLocal || currentOrderLocal.orderId !== order.orderId) return;
    const pos = getOrderQueuePosition(order.orderId);
    if (queueNumEl) queueNumEl.textContent = order.queueNum; if (queuePosEl) queuePosEl.textContent = pos !== null ? pos : "-";
    if (queueStatusEl) {
        queueStatusEl.textContent = order.status;
        queueStatusEl.className = "ml-2 font-semibold rounded px-2 py-0.5 " + (order.status === 'Preparing' ? 'bg-yellow-50 text-yellow-600' : order.status === 'Out for Delivery' ? 'bg-blue-100 text-blue-600' : 'bg-green-100 text-green-600');
    }
    if (deliveryStatusEl) deliveryStatusEl.textContent = order.deliveryStatus; if (deliveryEtaEl) deliveryEtaEl.textContent = formatSeconds(order.eta);
    if (progressBar) {
        let progressPercent = 0;
        if (order.status === 'Preparing') progressPercent = 12;
        else if (order.status === 'Out for Delivery') { const timeElapsed = order.deliveryStarted ? (Date.now() - order.deliveryStarted) / 1000 : 0; const totalDuration = order.eta; progressPercent = 12 + Math.min(80, (timeElapsed / totalDuration) * 80); }
        else if (order.status === 'Delivered') progressPercent = 100;
        progressBar.style.width = `${progressPercent}%`;
    }}
  queueListeners = queueListeners.filter(cb => cb !== updateStatus); deliveryStatusListeners = deliveryStatusListeners.filter(cb => cb !== updateStatus);
  subscribeOrderQueue(updateStatus); subscribeDeliveryStatus(updateStatus); updateStatus();
}
function notifyUserOfOwnOrder(order, msg, icon="fa-bell") {
  const notif = document.createElement("div"); notif.className = "flash-notification";
  notif.innerHTML = `<i class="fas ${icon} text-sky-300"></i><span class="font-medium">${msg}</span>`;
  document.body.appendChild(notif);
  setTimeout(() => { notif.classList.add('show'); }, 10);
  setTimeout(()=> { notif.classList.remove('show'); notif.classList.add('hide'); setTimeout(() => {notif.remove()}, 500); }, 3800);
}
let deliveryMapInstance = null; let deliveryMarkerInstance = null; let deliveryMapUpdateInterval = null;
function setupDeliveryMap(order, mapContainerId = 'delivery-map-live') {
  let deliveryMapContainer = document.getElementById(mapContainerId);
  let mapFallbackEl = document.getElementById('delivery-map-fallback');
  if (!deliveryMapContainer) { console.error("Delivery map container not found:", mapContainerId); if (mapFallbackEl) mapFallbackEl.style.display = "flex"; return; }
  deliveryMapContainer.style.display = "block"; if (mapFallbackEl) mapFallbackEl.style.display = "none";
  if (deliveryMapInstance) { deliveryMapInstance.remove(); deliveryMapInstance = null; }
  if (deliveryMapUpdateInterval) { clearInterval(deliveryMapUpdateInterval); }
  function showMapError() { deliveryMapContainer.style.display = "none"; if (mapFallbackEl) mapFallbackEl.style.display = "flex"; }
  function updateMarkerPosition() {
    if (!deliveryMapInstance || !deliveryMarkerInstance || !currentOrderLocal || currentOrderLocal.orderId !== order.orderId) { if(deliveryMapUpdateInterval) clearInterval(deliveryMapUpdateInterval); return; }
    if (!currentOrderLocal.driver || currentOrderLocal.status === 'Delivered') { if(deliveryMapUpdateInterval && currentOrderLocal.status === 'Delivered') clearInterval(deliveryMapUpdateInterval); return; }
    let secondsSinceStart = (currentOrderLocal.deliveryStarted ? ((Date.now() - currentOrderLocal.deliveryStarted) / 1000) : 0);
    let totalEtaSeconds = currentOrderLocal.eta; let percentComplete = Math.min(1, secondsSinceStart / totalEtaSeconds);
    let destLat = selectedHotel ? selectedHotel.lat : 6.4281; let destLng = selectedHotel ? selectedHotel.lon : 3.4216;
    let startLat = MOCK_VENDOR_LOCATION.lat; let startLng = MOCK_VENDOR_LOCATION.lon;
    let currentLat = startLat + percentComplete * (destLat - startLat); let currentLng = startLng + percentComplete * (destLng - startLng);
    deliveryMarkerInstance.setLatLng([currentLat, currentLng]); deliveryMapInstance.panTo([currentLat, currentLng]);
  }
  try {
    deliveryMapInstance = L.map(mapContainerId).setView([order.driver.lat, order.driver.lng], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(deliveryMapInstance);
    deliveryMarkerInstance = L.marker([order.driver.lat, order.driver.lng]).addTo(deliveryMapInstance).bindPopup("Your delivery is on the way!").openPopup();
    deliveryMapInstance.on("error", showMapError);
    deliveryMapUpdateInterval = setInterval(updateMarkerPosition, 2000);
  } catch(e) { console.error("Error creating delivery map:", e); showMapError(); }
}

// --- Main Application Logic ---
   // --- Global State & Config ---
        let currentLoggedInUser = null;
        let currentOrderDetails = { orderId: null, locationName: null, items: [] };
        let currentDeliveryFee = 0; // NGN
        let selectedLocationType = 'hotel';
        const MOCK_VENDOR_LOCATION = { lat: 6.5871, lon: 3.3705 };
        const DELIVERY_FEE_PER_KM = 200; // NGN
        const initialProductStocks = {};
        const heroImages = [
            "https://static.wixstatic.com/media/cfe6d1_84a78396f22b49dd86d14c247efae6c0~mv2.png",
            "https://static.wixstatic.com/media/cfe6d1_b8d9693e511c43d7a6714fd7faca4c1e~mv2.png",
            "https://static.wixstatic.com/media/cfe6d1_e74471f4bb5a4f85b5f53de7d43b00f2~mv2.png",
            "https://static.wixstatic.com/media/cfe6d1_78032b33403248fa9e115d7d1cbf037a~mv2.png"
        ];
        let currentHeroImageIndex = 0;

        // --- DOM Elements ---
        const sections = Array.from(document.querySelectorAll('.page-section'));
        const navLinks = Array.from(document.querySelectorAll('header .nav-link'));
        const mobileNavLinks = Array.from(document.querySelectorAll('#mobile-menu a.block'));
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const productListContainer = document.getElementById('product-list');
        const categoryBtns = Array.from(document.querySelectorAll('.category-btn'));
        const drinkSearchInput = document.getElementById('drink-search-input');
        const modal = document.getElementById('messageModal');
        const modalMessageText = document.getElementById('modalMessageText');
        const heroImageElement = document.getElementById('heroImageSlideshow');
        const cartViewModal = document.getElementById('cart-view-modal');
        const cartViewItemsContainer = document.getElementById('cart-view-items-container');
        const cartViewSubtotalEl = document.getElementById('cart-view-subtotal');
        const cartViewEmptyMsg = document.getElementById('cart-view-empty-msg');
        const cartViewCheckoutBtn = document.getElementById('cart-view-checkout-btn');


        const orderSteps = {
            locationSelection: document.getElementById('location-selection-step'),
            productBrowsing: document.getElementById('product-browsing-step'),
            cartReview: document.getElementById('cart-review-step'),
            orderConfirmation: document.getElementById('order-confirmation-step'),
            ratingReview: document.getElementById('rating-review-step')
        };

        const hotelSelectionContent = document.getElementById('hotel-selection-content');
        const apartmentAddressContent = document.getElementById('apartment-address-content');
        const apartmentStateSelect = document.getElementById('apartment-state');
        const apartmentCitySelect = document.getElementById('apartment-city');
        const apartmentStreetInput = document.getElementById('apartment-street-address');
        const enteredAddressInfo = document.getElementById('entered-address-info');
        const proceedToProductsBtn = document.getElementById('proceed-to-products-btn');
        const mapContainerCommon = document.getElementById('map-container-common');

        // --- Sample Data (Hotels, Products, GeoData) ---
        const nigeriaGeoData = {
            "Abia": { lat: 5.53, lon: 7.5, zoom: 9, cities: ["Umuahia", "Aba"] }, "Adamawa": { lat: 9.33, lon: 12.5, zoom: 8, cities: ["Yola", "Mubi"] },
            "Akwa Ibom": { lat: 5.0, lon: 7.83, zoom: 9, cities: ["Uyo", "Eket"] }, "Anambra": { lat: 6.23, lon: 7.0, zoom: 9, cities: ["Awka", "Onitsha", "Nnewi"] },
            "Bauchi": { lat: 10.5, lon: 10.0, zoom: 8, cities: ["Bauchi", "Azare"] }, "Bayelsa": { lat: 4.75, lon: 6.16, zoom: 9, cities: ["Yenagoa"] },
            "Benue": { lat: 7.33, lon: 8.75, zoom: 8, cities: ["Makurdi", "Gboko"] }, "Borno": { lat: 11.5, lon: 13.0, zoom: 7, cities: ["Maiduguri", "Biu"] },
            "Cross River": { lat: 5.83, lon: 8.5, zoom: 8, cities: ["Calabar", "Ikom"] }, "Delta": { lat: 5.5, lon: 6.0, zoom: 9, cities: ["Asaba", "Warri", "Sapele"] },
            "Ebonyi": { lat: 6.25, lon: 8.0, zoom: 9, cities: ["Abakaliki"] }, "Edo": { lat: 6.5, lon: 6.0, zoom: 9, cities: ["Benin City", "Auchi"] },
            "Ekiti": { lat: 7.75, lon: 5.33, zoom: 9, cities: ["Ado-Ekiti", "Ikere-Ekiti"] }, "Enugu": { lat: 6.5, lon: 7.5, zoom: 9, cities: ["Enugu", "Nsukka"] },
            "FCT": { lat: 9.07, lon: 7.49, zoom: 10, cities: ["Abuja", "Gwagwalada", "Kuje"] }, "Gombe": { lat: 10.25, lon: 11.17, zoom: 8, cities: ["Gombe"] },
            "Imo": { lat: 5.5, lon: 7.0, zoom: 9, cities: ["Owerri", "Orlu"] }, "Jigawa": { lat: 12.0, lon: 9.5, zoom: 8, cities: ["Dutse", "Hadejia"] },
            "Kaduna": { lat: 10.5, lon: 7.75, zoom: 8, cities: ["Kaduna", "Zaria"] }, "Kano": { lat: 11.5, lon: 8.5, zoom: 8, cities: ["Kano"] },
            "Katsina": { lat: 12.5, lon: 7.5, zoom: 8, cities: ["Katsina", "Funtua"] }, "Kebbi": { lat: 11.5, lon: 4.0, zoom: 8, cities: ["Birnin Kebbi", "Argungu"] },
            "Kogi": { lat: 7.75, lon: 6.75, zoom: 8, cities: ["Lokoja", "Okene"] }, "Kwara": { lat: 8.5, lon: 5.0, zoom: 8, cities: ["Ilorin", "Offa"] },
            "Lagos": { lat: 6.52, lon: 3.37, zoom: 10, cities: ["Ikeja", "Lagos Island", "Lekki", "Victoria Island", "Badagry", "Ikorodu", "Apapa", "Surulere"] },
            "Nasarawa": { lat: 8.5, lon: 8.25, zoom: 8, cities: ["Lafia", "Keffi"] }, "Niger": { lat: 10.0, lon: 6.0, zoom: 7, cities: ["Minna", "Bida", "Suleja"] },
            "Ogun": { lat: 7.0, lon: 3.5, zoom: 9, cities: ["Abeokuta", "Ijebu Ode", "Sango Otta"] }, "Ondo": { lat: 7.0, lon: 5.0, zoom: 9, cities: ["Akure", "Ondo Town", "Owo"] },
            "Osun": { lat: 7.5, lon: 4.5, zoom: 9, cities: ["Osogbo", "Ile-Ife", "Ilesa"] }, "Oyo": { lat: 8.0, lon: 4.0, zoom: 8, cities: ["Ibadan", "Ogbomosho", "Oyo"] },
            "Plateau": { lat: 9.25, lon: 9.0, zoom: 8, cities: ["Jos", "Barkin Ladi"] }, "Rivers": { lat: 4.75, lon: 7.0, zoom: 9, cities: ["Port Harcourt", "Bonny"] },
            "Sokoto": { lat: 13.0, lon: 5.25, zoom: 8, cities: ["Sokoto"] }, "Taraba": { lat: 8.0, lon: 10.5, zoom: 7, cities: ["Jalingo", "Wukari"] },
            "Yobe": { lat: 12.0, lon: 11.5, zoom: 8, cities: ["Damaturu", "Potiskum"] }, "Zamfara": { lat: 12.25, lon: 6.25, zoom: 8, cities: ["Gusau"] }
        };
        const hotels = [
            { id: 1, name: "Transcorp Hilton Abuja", address: "1 Aguiyi Ironsi St, Maitama, Abuja", lat: 9.0648, lon: 7.4891, deliveryFee: 0.00, state: "FCT", city: "Abuja" },
            { id: 2, name: "Eko Hotel Lagos", address: "Plot 1415 Adetokunbo Ademola Street, Lagos", lat: 6.4281, lon: 3.4216, deliveryFee: 0.00, state: "Lagos", city: "Victoria Island" },
            { id: 3, name: "Nordic Hotel Abuja", address: "Blvd. 26, Alex Ekwueme Way, Jabi, Abuja", lat: 9.0510, lon: 7.4713, deliveryFee: 500.00, state: "FCT", city: "Abuja" },
            { id: 4, name: "Radisson Blu Anchorage Hotel, Lagos", address: "1a Ozumba Mbadiwe Ave, VI, Lagos", lat: 6.4346, lon: 3.4165, deliveryFee: 0.00, state: "Lagos", city: "Victoria Island" },
            { id: 5, name: "Le Méridien Ogeyi Place, Port Harcourt", address: "45 Tombia St, GRA Phase 2, Port Harcourt", lat: 4.8242, lon: 7.0321, deliveryFee: 0.00, state: "Rivers", city: "Port Harcourt"}
        ];
        let selectedHotel = null;
        let enteredApartmentAddress = { state: null, city: null, street: null, lat: null, lon: null };
        let map; let userMarker; let hotelMarkers = [];
        const products = [
            { "id": 1, "name": "Still Water (Eva)", "category": "water", "price": 500, "image": "https://www.gbnfarms.com/cdn/shop/products/c6EIPlBTZ0_1024x1024.jpg", "description": "Pure natural spring water (75cl).", "stock": 15 },
            { "id": 2, "name": "Sparkling Water (Perrier)", "category": "water", "price": 1200, "image": "https://i5.walmartimages.com/seo/Perrier-Carbonated-Mineral-Water-11-15-fl-oz-Glass-Bottle-4-Pack-Allergens-Not-Contained_8d79486a-d2fe-4972-9e78-b5ea56ddee5a.54a750538b6915789025f8f7c7e18b0e.jpeg?odnHeight=640&odnWidth=640&odnBg=FFFFFF", "description": "Crisp & bubbly (330ml).", "stock": 10 },
            { "id": 3, "name": "Coca-Cola Classic", "category": "softdrinks", "price": 1000, "image": "https://www.wholesale-supplier.uk/media/catalog/product/cache/768c9b9886b55f3557afb95da5189daf/t/u/tumbnail_007e04e4-4ae3-443f-909c-69c095cd6130_1.jpg", "description": "The original cola taste (330ml can).", "stock": 20 },
            { "id": 4, "name": "Fanta Orange", "category": "softdrinks", "price": 1000, "image": "https://cdn.bmstores.co.uk/images/hpcProductImage/imgDetail1150/145845-fanta-orange-can-330ml.jpg", "description": "Tangy orange soda (330ml can).", "stock": 0 },
            { "id": 5, "name": "Schweppes Lemonade", "category": "softdrinks", "price": 900, "image": "https://maxmartonline.com/images/thumbs/0015810_schweppes-lemonade-can-330ml.jpeg", "description": "Sweet & sour lemonade (330ml can).", "stock": 12 },
            { "id": 6, "name": "Heineken Lager Beer", "category": "alcoholic", "price": 1500, "image": "https://myliquorhub.com/wp-content/uploads/2022/10/Heineken-Lager-Beer-Can-.jpg", "description": "Premium Lager Beer (330ml can).", "stock": 10 },
            { "id": 7, "name": "Red Wine (Carlo Rossi Mini)", "category": "alcoholic", "price": 3000, "image": "https://img.lazcdn.com/g/p/23d9dfff3f0ef4192bc3d200238e36d4.jpg_720x720q80.jpg_.webp", "description": "Smooth mini red wine (187ml).", "stock": 5 },
            { "id": 8, "name": "Gordon's Gin & Tonic", "category": "alcoholic", "price": 2500, "image": "https://www.bestwaywholesale.co.uk/img/products/1000/6/5000289927376.jpg", "description": "Classic G&T (250ml can).", "stock": 8 },
            { "id": 9, "name": "Johnnie Walker Black Label", "category": "spirits", "price": 15000, "image": "https://clubmalt.com/wp-content/uploads/2023/03/Johnnie-Walker-Black-Label-Anniversary-Edition.jpg", "description": "Blended Scotch Whisky (75cl).", "stock": 3 },
            { "id": 10, "name": "Jameson Irish Whiskey", "category": "spirits", "price": 12000, "image": "https://cellarcentral.ng/wp-content/uploads/2017/02/Jameson-WhiskY.webp", "description": "Smooth Irish Whiskey (70cl).", "stock": 4 },
            { "id": 11, "name": "Captain Morgan Spiced Rum", "category": "spirits", "price": 8000, "image": "https://www.vipbottles.co.uk/wp-content/uploads/2020/11/Captain-Morgan-100-Proof-Spiced-Rum-75cl.png", "description": "Caribbean Spiced Rum (75cl).", "stock": 6 },
            { "id": 12, "name": "Bacardi Carta Blanca", "category": "spirits", "price": 7500, "image": "https://naijaliquor.com/wp-content/uploads/2023/03/Bacardi-Superior-Carta-Blanca-Rum.png", "description": "Classic White Rum (75cl).", "stock": 7 },
            { "id": 13, "name": "Schweppes Ginger Ale", "category": "mixers", "price": 800, "image": "https://www.kavakonstantakopoulos.gr/images/thumbs/0001236_500.jpg", "description": "Perfect for mixing (330ml can).", "stock": 15 },
            { "id": 14, "name": "Tonic Water (Generic)", "category": "mixers", "price": 700, "image": "https://nordicexpatshop.com/media/catalog/product/cache/7d10f99bd9e850d2940843c910c1bfd9/h/a/harboe_indian_tonic.jpg", "description": "Crisp tonic water (330ml can).", "stock": 18 },
        ];
        products.forEach(p => initialProductStocks[p.id] = p.stock);
        let cart = [];

        // --- Ripple Effect Function ---
        function createRipple(event) {
            const element = event.currentTarget;
            // Ensure element is set to relative if not already, and overflow hidden
            const currentPosition = window.getComputedStyle(element).position;
            if (currentPosition === 'static') {
                element.style.position = 'relative';
            }
            element.style.overflow = 'hidden';

            const circle = document.createElement("span");
            const diameter = Math.max(element.clientWidth, element.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            // Calculate click position relative to the element's top-left corner
            const rect = element.getBoundingClientRect();
            circle.style.left = `${event.clientX - rect.left - radius}px`;
            circle.style.top = `${event.clientY - rect.top - radius}px`;
            circle.classList.add("ripple");

            const existingRipple = element.getElementsByClassName("ripple")[0];
            if (existingRipple) {
                existingRipple.remove();
            }
            element.appendChild(circle);
        }

        // --- Intersection Observer for Scroll Animations ---
        const scrollObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    if (!entry.target.classList.contains('stagger-children')) { // Don't unobserve parent of staggered items yet
                       // observer.unobserve(entry.target); // Optional: Unobserve after animation to prevent re-triggering
                    }
                } else {
                    // Optional: remove 'is-visible' if you want animations to replay on scroll up then down
                    // entry.target.classList.remove('is-visible');
                }
            });
        }, { threshold: 0.1 }); // Adjust threshold (0.0 to 1.0) for when animation triggers

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            loadCartFromLocalStorage(); // Load cart first
            loadUserDetailsFromLocalStorage(); // Load user details for caching
            loadLocationDetailsFromLocalStorage(); // Load location for caching

            showSection('home');
            setActiveLink(navLinks.find(link => link.getAttribute('onclick').includes('home')));
            updateUserUI();
            setupEventListeners();
            populateStatesDropdown();
            startHeroSlideshow();
            showPromoBanner();
            updateSocialProof();
            updateCartDisplay(); // Initial cart display update

            // Attach Ripple Effect to buttons and other interactive elements
            const rippleElements = document.querySelectorAll('.btn, .location-type-toggle button, .category-btn, .hotel-list-item');
            rippleElements.forEach(el => {
                el.addEventListener('click', createRipple);
            });

            // Setup Scroll Animations
            const elementsToAnimate = document.querySelectorAll('.animate-on-scroll, .why-us-card, .product-card, #how-it-works .flex.flex-col > div:first-child, section > h2, .stagger-children, #faq > div > div');
            elementsToAnimate.forEach(el => {
                // If it's not already marked with a specific animation utility class, add the generic one
                if (!el.classList.contains('animate__fadeInUp') && !el.classList.contains('animate__fadeInDown')) {
                     el.classList.add('animate-on-scroll'); // Ensure our base class is there if not using external lib class
                }
                scrollObserver.observe(el);
            });
             // For product list, re-observe if it's dynamically populated and might become hidden/visible
            const productListObserver = new MutationObserver(() => {
                document.querySelectorAll('#product-list .product-card').forEach(card => {
                    card.classList.add('animate-on-scroll'); // Ensure class for observer
                    scrollObserver.observe(card);
                });
            });
            if (productListContainer) {
                productListObserver.observe(productListContainer, { childList: true });
            }

        });

        function setupEventListeners() {
            mobileMenuButton.addEventListener('click', toggleMobileMenu);
            document.querySelectorAll('header .nav-link, #mobile-menu a.block').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const isMobile = link.closest('#mobile-menu') !== null;
                    const sectionMatch = link.getAttribute('onclick').match(/showSection\('([^']+)'\)/);
                    if (sectionMatch && sectionMatch[1]) {
                        const sectionId = sectionMatch[1];
                        setActiveLink(link, isMobile);
                        showSection(sectionId);
                        if (isMobile) toggleMobileMenu();
                    } else if (link.getAttribute('onclick').includes('logoutUser')) {
                        logoutUser();
                        if (isMobile) toggleMobileMenu();
                    }
                });
            });
            document.querySelectorAll('.star-rating .fa-star').forEach(star => {
                star.addEventListener('click', () => setRating(star.dataset.value));
                star.addEventListener('mouseover', () => highlightStars(star.dataset.value));
                star.addEventListener('mouseout', () => highlightStars(document.getElementById('selected-rating').value));
            });
            const inquiryTypeSelect = document.getElementById('contact-inquiry-type');
            if(inquiryTypeSelect) {
                inquiryTypeSelect.addEventListener('change', (e) => {
                    document.getElementById('contact-order-id-group').classList.toggle('hidden', !(e.target.value === 'complaint' || e.target.value === 'support'));
                });
            }
            const chatWidget = document.getElementById('chat-widget');
            if(chatWidget) chatWidget.addEventListener('click', () => showModalMessage("Live chat support is currently unavailable. Please use the contact form."));
            apartmentStateSelect.addEventListener('change', handleStateChange);
            apartmentCitySelect.addEventListener('change', handleCityChange);
            apartmentStreetInput.addEventListener('input', () => {
                enteredApartmentAddress.street = apartmentStreetInput.value.trim();
                validateLocationSelection();
            });
            if(drinkSearchInput) {
                drinkSearchInput.addEventListener('input', () => {
                    renderProducts(categoryBtns.find(b => b.classList.contains('active'))?.getAttribute('onclick').match(/'([^']+)'/)[1] || 'all');
                });
            }
        }

        function startHeroSlideshow() {
            if (!heroImageElement || heroImages.length === 0) return;
            // Preload images and create img elements
            const parentContainer = heroImageElement.parentNode;
            heroImages.forEach((src, index) => {
                if (index === 0) { // First image is already in HTML
                    heroImageElement.src = src; // Ensure it's set
                } else {
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = "Hotel Drinks Promotion Slideshow Image";
                    parentContainer.appendChild(img);
                }
            });

            const allHeroImages = parentContainer.querySelectorAll('img');
            if (allHeroImages.length > 0) allHeroImages[0].classList.add('active'); // Activate first one

            setInterval(() => {
                allHeroImages[currentHeroImageIndex].classList.remove('active');
                currentHeroImageIndex = (currentHeroImageIndex + 1) % allHeroImages.length;
                allHeroImages[currentHeroImageIndex].classList.add('active');
            }, 5000);
        }

        // --- LocalStorage Caching ---
        function saveCartToLocalStorage() { localStorage.setItem('hotelDrinksCart', JSON.stringify(cart)); }
        function loadCartFromLocalStorage() {
            const savedCart = localStorage.getItem('hotelDrinksCart');
            if (savedCart) { cart = JSON.parse(savedCart); }
            // Ensure product stocks are consistent with loaded cart
            products.forEach(p => {
                const cartItem = cart.find(item => item.id === p.id);
                if(cartItem) {
                    p.stock = initialProductStocks[p.id] - cartItem.quantity;
                } else {
                    p.stock = initialProductStocks[p.id];
                }
            });
        }
        function saveUserDetailsToLocalStorage() {
            if (!currentLoggedInUser) { // Only save for guests
                localStorage.setItem('guestRoomNumber', document.getElementById('checkout-room-number').value);
                localStorage.setItem('guestName', document.getElementById('checkout-guest-name').value);
                localStorage.setItem('guestPhoneNumber', document.getElementById('checkout-phone-number').value);
            }
        }
        function loadUserDetailsFromLocalStorage() {
            if (!currentLoggedInUser) {
                const savedRoom = localStorage.getItem('guestRoomNumber');
                const savedName = localStorage.getItem('guestName');
                const savedPhone = localStorage.getItem('guestPhoneNumber');
                if (savedRoom) document.getElementById('checkout-room-number').value = savedRoom;
                if (savedName) document.getElementById('checkout-guest-name').value = savedName;
                if (savedPhone) document.getElementById('checkout-phone-number').value = savedPhone;
            }
        }
         function saveLocationDetailsToLocalStorage() {
            localStorage.setItem('lastLocationType', selectedLocationType);
            if (selectedLocationType === 'hotel' && selectedHotel) {
                localStorage.setItem('lastSelectedHotelId', selectedHotel.id);
            } else {
                localStorage.removeItem('lastSelectedHotelId');
            }
            if (selectedLocationType === 'apartment' && enteredApartmentAddress.street) {
                localStorage.setItem('lastApartmentAddress', JSON.stringify(enteredApartmentAddress));
            } else {
                localStorage.removeItem('lastApartmentAddress');
            }
        }
        function loadLocationDetailsFromLocalStorage() {
            const lastType = localStorage.getItem('lastLocationType');
            if (lastType) {
                selectedLocationType = lastType; // Set it before calling toggleLocationType indirectly
            }
        }


        // --- Navigation & UI ---
        function showSection(sectionId, skipOrderReset = false) {
            sections.forEach(section => section.classList.toggle('hidden', section.id !== sectionId));
            window.scrollTo(0, 0);
            if (sectionId === 'order' && !skipOrderReset) {
                initializeOrderFlow();
                orderSteps.locationSelection.classList.remove('hidden');
                orderSteps.productBrowsing.classList.add('hidden');
                orderSteps.cartReview.classList.add('hidden');
                orderSteps.orderConfirmation.classList.add('hidden');
                orderSteps.ratingReview.classList.add('hidden');
            } else if (sectionId !== 'order' && !skipOrderReset) {
                 Object.values(orderSteps).forEach(step => step.classList.add('hidden'));
            }
            // Trigger scroll animations for newly shown section elements
            if(document.getElementById(sectionId)) {
                document.getElementById(sectionId).querySelectorAll('.animate-on-scroll, .stagger-children').forEach(el => {
                    scrollObserver.observe(el); // Re-observe if they might have been unobserved
                    // If already visible due to no scroll, manually trigger
                    const rect = el.getBoundingClientRect();
                    if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
                        el.classList.add('is-visible');
                    }
                });
            }
        }
        function setActiveLink(activeLink, isMobile = false) {
            if (!activeLink || !activeLink.getAttribute('onclick')) return;
            const allNavLinks = [...navLinks, ...mobileNavLinks];
            allNavLinks.forEach(link => link.classList.remove('active'));
            const targetSectionMatch = activeLink.getAttribute('onclick').match(/showSection\('([^']+)'\)/);
            if (!targetSectionMatch) {
                 if (activeLink.classList.contains('nav-link') || activeLink.parentElement.id.includes('auth-links') || activeLink.parentElement.id.includes('user-actions')) {
                    activeLink.classList.add('active');
                 }
                 return;
            }
            const targetSection = targetSectionMatch[1];
            navLinks.forEach(link => { if (link.getAttribute('onclick')?.includes(`showSection('${targetSection}')`)) link.classList.add('active'); });
            mobileNavLinks.forEach(link => { if (link.getAttribute('onclick')?.includes(`showSection('${targetSection}')`)) link.classList.add('active'); });
            if (navLinks.includes(activeLink) || mobileNavLinks.includes(activeLink)) activeLink.classList.add('active');
        }
        function toggleMobileMenu() { mobileMenu.classList.toggle('hidden'); }
        function updateUserUI() {
            const ids = ['auth-links-desktop', 'user-actions-desktop', 'welcome-user-desktop', 'auth-links-mobile', 'user-actions-mobile', 'welcome-user-mobile'];
            const [authDesk, userDesk, welcomeDesk, authMob, userMob, welcomeMob] = ids.map(id => document.getElementById(id));
            if (currentLoggedInUser) {
                authDesk.classList.add('hidden'); userDesk.classList.remove('hidden'); userDesk.classList.add('flex');
                welcomeDesk.textContent = `Hi, ${currentLoggedInUser.name.split(' ')[0]}!`;
                authMob.classList.add('hidden'); userMob.classList.remove('hidden'); userMob.classList.add('flex','flex-col'); // Adjust display for mobile
                welcomeMob.textContent = `Hi, ${currentLoggedInUser.name.split(' ')[0]}!`;
            } else {
                authDesk.classList.remove('hidden'); authDesk.classList.add('flex');userDesk.classList.add('hidden');userDesk.classList.remove('flex');
                authMob.classList.remove('hidden'); userMob.classList.add('hidden'); userMob.classList.remove('flex','flex-col');
            }
        }

        // --- Auth (Mock) ---
        function handleLogin() {
            const email = document.getElementById('login-email').value; const password = document.getElementById('login-password').value;
            if (!email || !password) { showModalMessage("Please enter email and password.", "error"); return; }
            currentLoggedInUser = { name: "Demo User", email: email, phone: "08012345678" };
            localStorage.removeItem('guestRoomNumber'); localStorage.removeItem('guestName'); localStorage.removeItem('guestPhoneNumber'); // Clear guest cache on login
            showModalMessage(`Welcome back, ${currentLoggedInUser.name}!`, "success");
            updateUserUI(); showSection('home'); setActiveLink(navLinks.find(link => link.getAttribute('onclick').includes('home')));
        }
        function handleRegistration() {
            const name = document.getElementById('register-name').value; const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value; const password = document.getElementById('register-password').value;
            if (!name || !email || !password) { showModalMessage("Please fill in Name, Email, and Password.", "error"); return; }
            currentLoggedInUser = { name, email, phone };
            localStorage.removeItem('guestRoomNumber'); localStorage.removeItem('guestName'); localStorage.removeItem('guestPhoneNumber'); // Clear guest cache
            showModalMessage("Registration successful! You are now logged in.", "success");
            updateUserUI(); showSection('home'); setActiveLink(navLinks.find(link => link.getAttribute('onclick').includes('home')));
        }
        function logoutUser() {
            currentLoggedInUser = null; showModalMessage("You have been logged out.", "info");
            updateUserUI(); showSection('home'); setActiveLink(navLinks.find(link => link.getAttribute('onclick').includes('home')));
        }

              function handleVendorSignup() {
            const form = document.getElementById('vendor-signup-form');
            if (!document.getElementById('vendor-name').value || !document.getElementById('vendor-email').value) {
                showModalMessage("Please fill in Business Name and Email.", "error"); return;
            }
            showModalMessage("Thank you for your interest! Our team will contact you shortly.", "success");
            form.reset(); showSection('home');
        }

        // --- Contact Form ---
        function handleContactSubmit() {
            const form = document.getElementById('contact-form');
            if (!document.getElementById('contact-name').value || !document.getElementById('contact-email').value || !document.getElementById('contact-message').value) {
                showModalMessage("Please fill in Name, Email, and Message.", "error"); return;
            }
            showModalMessage("Your message has been sent! We'll get back to you soon.", "success");
            form.reset(); document.getElementById('contact-order-id-group').classList.add('hidden');
            showSection('home');
        }

        // --- Order Flow Logic ---
        function toggleLocationType(type) {
            selectedLocationType = type;
            document.getElementById('select-hotel-type-btn').classList.toggle('active', type === 'hotel');
            document.getElementById('select-apartment-type-btn').classList.toggle('active', type === 'apartment');
            hotelSelectionContent.classList.toggle('hidden', type !== 'hotel');
            apartmentAddressContent.classList.toggle('hidden', type !== 'apartment');
            mapContainerCommon.classList.remove('hidden');

            selectedHotel = null; enteredApartmentAddress = { state: null, city: null, street: null, lat: null, lon: null };
            apartmentStreetInput.value = ''; document.getElementById('selected-hotel-info').innerHTML = 'Selected Hotel: <span class="text-sky-600">None</span>';
            enteredAddressInfo.classList.add('hidden'); currentDeliveryFee = (type === 'apartment') ? 0 : 0;

            if (map) map.invalidateSize();
            if (type === 'apartment') getUserLocationOrSetDefault(true);
            else if (type === 'hotel') getUserLocationOrSetDefault();
            validateLocationSelection();
        }

        function validateLocationSelection() {
            let isValid = false;
            if (selectedLocationType === 'hotel' && selectedHotel) {
                isValid = true;
                currentDeliveryFee = selectedHotel.deliveryFee === 0 ? Math.round(haversineDistance(MOCK_VENDOR_LOCATION.lat, MOCK_VENDOR_LOCATION.lon, selectedHotel.lat, selectedHotel.lon) * DELIVERY_FEE_PER_KM) : selectedHotel.deliveryFee;
            } else if (selectedLocationType === 'apartment' && enteredApartmentAddress.state && enteredApartmentAddress.city && enteredApartmentAddress.street && enteredApartmentAddress.street.length > 3) {
                isValid = true;
                enteredAddressInfo.querySelector('span').textContent = `${enteredApartmentAddress.street}, ${enteredApartmentAddress.city}, ${enteredApartmentAddress.state}`;
                enteredAddressInfo.classList.remove('hidden');
                const cityData = nigeriaGeoData[enteredApartmentAddress.state];
                if (cityData) { enteredApartmentAddress.lat = cityData.lat; enteredApartmentAddress.lon = cityData.lon; currentDeliveryFee = Math.round(haversineDistance(MOCK_VENDOR_LOCATION.lat, MOCK_VENDOR_LOCATION.lon, cityData.lat, cityData.lon) * DELIVERY_FEE_PER_KM); }
                else { currentDeliveryFee = 1000; }
            } else { enteredAddressInfo.classList.add('hidden'); currentDeliveryFee = 0; }

            if (isValid) saveLocationDetailsToLocalStorage(); // Save after valid selection
            proceedToProductsBtn.disabled = !isValid;
            updateCartReviewDisplay();
        }

        function initializeOrderFlow() {
            Object.values(orderSteps).forEach(step => step.classList.add('hidden'));
            orderSteps.locationSelection.classList.remove('hidden');
            mapContainerCommon.classList.remove('hidden');

            // Load cached location type first, then toggle
            const cachedLocationType = localStorage.getItem('lastLocationType');
            toggleLocationType(cachedLocationType || 'hotel'); // Default to hotel if no cache

            if(cachedLocationType === 'hotel') {
                const cachedHotelId = localStorage.getItem('lastSelectedHotelId');
                if (cachedHotelId && hotels.find(h => h.id === parseInt(cachedHotelId))) {
                     // selectHotelById will be called by getUserLocationOrSetDefault if successful, or manually
                }
            } else if (cachedLocationType === 'apartment') {
                const cachedAddress = localStorage.getItem('lastApartmentAddress');
                if (cachedAddress) {
                    enteredApartmentAddress = JSON.parse(cachedAddress);
                    apartmentStateSelect.value = enteredApartmentAddress.state || "";
                    populateCitiesDropdown(enteredApartmentAddress.state); // Ensure cities are populated
                    apartmentCitySelect.value = enteredApartmentAddress.city || "";
                    apartmentStreetInput.value = enteredApartmentAddress.street || "";
                }
            }

            if (!map) initMap();
            else { map.invalidateSize(); if (userMarker) map.removeLayer(userMarker); userMarker = null; getUserLocationOrSetDefault(selectedLocationType === 'apartment'); }

            populateHotelList(); // This remains important for hotel selection type
             if(selectedLocationType === 'hotel') { // Attempt to re-select hotel after list is populated
                const cachedHotelId = localStorage.getItem('lastSelectedHotelId');
                if (cachedHotelId) {
                    selectHotelById(parseInt(cachedHotelId)); // This will also call validateLocationSelection
                }
            } else {
                 validateLocationSelection(); // Validate if it's apartment type with prefilled data
            }


            // cart = []; // Cart is now loaded from localStorage earlier
            updateCartDisplay();
            currentOrderLocal = null;
            if (deliveryMapInstance) { deliveryMapInstance.remove(); deliveryMapInstance = null; }
            if (deliveryMapUpdateInterval) { clearInterval(deliveryMapUpdateInterval); deliveryMapUpdateInterval = null; }
        }


        function proceedToProducts() {
            orderSteps.locationSelection.classList.add('hidden');
            orderSteps.productBrowsing.classList.remove('hidden');
            renderProducts();
             // Ensure product list and its parent for stagger animation are observed
            if (productListContainer && productListContainer.classList.contains('stagger-children')) {
                scrollObserver.observe(productListContainer);
            }
        }
        function proceedToCartReview() {
            if (cart.length === 0) { showModalMessage("Your cart is empty. Please add some items.", "info"); return; }
            orderSteps.productBrowsing.classList.add('hidden');
            orderSteps.cartReview.classList.remove('hidden');
            updateCartReviewDisplay(); // This already renders cart items in the review step
            loadUserDetailsFromLocalStorage(); // Pre-fill guest details
        }

        function confirmAndPlaceOrder() {
          clearCart();
            const roomNumber = document.getElementById('checkout-room-number').value;
            const guestName = document.getElementById('checkout-guest-name').value;
            if (!roomNumber.trim() || !guestName.trim()) { showModalMessage("Please enter Room/Apt Number and Your Name.", "error"); return; }
            if (cart.length === 0) { showModalMessage("Your cart is empty.", "error"); return; }

            saveUserDetailsToLocalStorage(); // Save details before placing order

            currentOrderDetails.orderId = "HOD" + Math.floor(Math.random() * 90000) + 10000;
            currentOrderDetails.items = cart.map(item => ({ name: item.name, quantity: item.quantity }));
            if (selectedLocationType === 'hotel' && selectedHotel) currentOrderDetails.locationName = selectedHotel.name;
            else if (selectedLocationType === 'apartment' && enteredApartmentAddress.street) currentOrderDetails.locationName = `${enteredApartmentAddress.street.substring(0,15)}..., ${enteredApartmentAddress.city}`;
            else currentOrderDetails.locationName = "Your Location";

            const confirmationStepContainer = orderSteps.orderConfirmation;
            confirmationStepContainer.innerHTML = `
                <div class="flex flex-col items-center text-center animate-on-scroll is-visible"> <!-- Added animation classes -->
                  <i class="fas fa-check-circle text-green-500 text-5xl mb-3"></i> <h2 class="text-2xl font-bold text-sky-800 mb-2">Order Confirmed!</h2>
                  <div class="mb-1 text-gray-600">Thanks for ordering, ${guestName}! Your order for <strong class="text-sky-700">${currentOrderDetails.locationName}</strong>:</div>
                  <div class="font-mono text-sky-700 text-lg mb-2">Order ID: <span id="confirmed-order-id-detailed">${currentOrderDetails.orderId}</span></div> <hr class="my-4 w-full max-w-md">
                  <div id="order-queue-summary" class="flex flex-col items-center w-full">
                    <div class="font-medium text-lg">Your Queue Number: <span id="queue-num" class="font-bold"></span></div>
                    <div class="text-sky-700 text-base mt-1">Your Position In Queue: <span id="queue-pos" class="font-bold"></span></div>
                    <div class="flex items-center mt-1 text-xs">Status: <span id="queue-status" class="ml-2 font-semibold rounded px-2 py-0.5"></span></div>
                  </div>
                  <div class="w-full max-w-xl mx-auto my-6">
                    <div class="flex items-center gap-3 mb-2 justify-center"> <span class="font-medium text-gray-600">Delivery Progress:</span> <span id="delivery-status" class="font-bold"></span> <span id="delivery-eta" class="bg-sky-50 text-sky-600 text-xs font-semibold rounded px-2 ml-2"></span> </div>
                    <div class="w-full h-3 bg-sky-100 rounded-full mb-4 overflow-hidden"> <div id="progress-bar" class="h-full bg-sky-400 rounded-full transition-all duration-700" style="width:0%"></div> </div>
                    <div id="delivery-map-live" class="w-full h-48 rounded border border-slate-200"></div>
                    <div id="delivery-map-fallback" class="w-full h-48 flex items-center justify-center text-sm text-red-600 rounded bg-slate-50 hidden"> Unable to track delivery. Please check your connection or try again later. </div>
                  </div>
                  <div class="space-y-3 sm:space-y-0 sm:space-x-3 mt-5"> <button class="btn btn-primary py-2.5 px-8" onclick="proceedToRating()">Rate Your Service</button> <button class="btn btn-secondary py-2.5 px-8" onclick="resetToHome()">Back to Home</button> </div>
                </div>`;
            orderSteps.cartReview.classList.add('hidden'); confirmationStepContainer.classList.remove('hidden');
            currentOrderLocal = postMockOrder({ orderId: currentOrderDetails.orderId, user: guestName, items: currentOrderDetails.items, location: currentOrderDetails.locationName });
            setupOrderStatusUI(currentOrderLocal); notifyUserOfOwnOrder(currentOrderLocal, "Order Confirmed! Status: Preparing", "fa-circle-check");
            function onDeliveryStatusChange() {
                if (!currentOrderLocal || currentOrderLocal.orderId !== currentOrderDetails.orderId ) return;
                if (currentOrderLocal.status === "Out for Delivery") { notifyUserOfOwnOrder(currentOrderLocal, "Your drink is on the way!", "fa-truck"); deliveryStatusListeners = deliveryStatusListeners.filter(cb => cb !== onDeliveryStatusChange); }
                if (currentOrderLocal.status === "Delivered") { notifyUserOfOwnOrder(currentOrderLocal, "Order delivered! Enjoy!", "fa-champagne-glasses"); deliveryStatusListeners = deliveryStatusListeners.filter(cb => cb !== onDeliveryStatusChange); }
            }
            deliveryStatusListeners = deliveryStatusListeners.filter(cb => cb !== onDeliveryStatusChange); subscribeDeliveryStatus(onDeliveryStatusChange);
            setTimeout(()=> { if(currentOrderLocal) setupDeliveryMap(currentOrderLocal, 'delivery-map-live'); }, 1250);
        }

        function proceedToRating() { document.getElementById('rating-order-id').textContent = `${currentOrderDetails.orderId}`;
            orderSteps.orderConfirmation.classList.add('hidden');
            orderSteps.ratingReview.classList.remove('hidden');
            document.getElementById('selected-rating').value = "0";
            document.getElementById('review-text').value = "";
            highlightStars(0);}
        function resetToHome() {
            showSection('home');
            setActiveLink(navLinks.find(link => link.getAttribute('onclick').includes('home')));
            initializeOrderFlow(); // Resets cart to empty (or from localStorage if that's desired on full reset)
            currentOrderLocal = null; orderQueue = []; queueListeners = []; deliveryStatusListeners = [];
            if (deliveryMapInstance) { deliveryMapInstance.remove(); deliveryMapInstance = null; }
            if (deliveryMapUpdateInterval) { clearInterval(deliveryMapUpdateInterval); deliveryMapUpdateInterval = null; }
            products.forEach(p => { p.stock = initialProductStocks[p.id]; }); // Restore initial stocks
            cart = []; // Explicitly clear cart array for a full reset
            saveCartToLocalStorage(); // Save empty cart
            updateCartDisplay(); // Update UI
        }

        // --- Product & Cart Logic ---
        function renderProducts(filter = 'all', searchTerm = '') {
            productListContainer.innerHTML = ''; // Clear previous products
            const currentSearchTerm = (drinkSearchInput.value || '').toLowerCase().trim();

            let tempProducts = products;
            if (filter !== 'all') {
                tempProducts = tempProducts.filter(p => p.category === filter);
            }
            if (currentSearchTerm) {
                tempProducts = tempProducts.filter(p =>
                    p.name.toLowerCase().includes(currentSearchTerm) ||
                    p.description.toLowerCase().includes(currentSearchTerm)
                );
            }

            if (tempProducts.length === 0) {
                productListContainer.innerHTML = `<p class="text-slate-500 col-span-full text-center py-8">No products found matching your criteria.</p>`;
                return;
            }
            tempProducts.forEach((product, index) => { // Added index for potential stagger
                const cardHTML = `
                    <div class="product-card card flex flex-col animate-on-scroll"> <!-- Added animate-on-scroll -->
                        <img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.onerror=null;this.src='https://placehold.co/400x300/e2e8f0/64748b?text=Image+Unavailable';">
                        <div class="p-5 flex flex-col flex-grow">
                            <h4 class="text-lg font-semibold text-slate-800 mb-1.5">${product.name}</h4>
                            <p class="text-sm text-slate-500 mb-3 flex-grow">${product.description}</p>
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-2xl font-bold text-sky-600">₦${product.price.toLocaleString()}</span>
                                ${product.stock > 0 ? `<span class="text-xs font-medium ${product.stock < 5 ? 'text-amber-600 bg-amber-100' : 'text-green-600 bg-green-100'} px-2.5 py-1 rounded-full">${product.stock} left</span>` : '<span class="text-xs font-medium text-red-600 bg-red-100 px-2.5 py-1 rounded-full">Out of Stock</span>'}
                            </div>
                            <button class="w-full btn ${product.stock > 0 ? 'btn-primary' : 'btn-primary'} text-sm py-2.5" ${product.stock > 0 ? `onclick="addToCart(${product.id})"` : 'disabled'}>
                                ${product.stock > 0 ? '<i class="fas fa-cart-plus mr-1.5"></i>Add to Cart' : 'Unavailable'}
                            </button>
                        </div>
                    </div>`;
                productListContainer.innerHTML += cardHTML;
            });
            // Re-observe newly added cards if using IntersectionObserver for them individually
            productListContainer.querySelectorAll('.product-card.animate-on-scroll').forEach(card => {
                 scrollObserver.observe(card);
            });
             // If productListContainer itself is a stagger-children target, trigger its visibility
            if (productListContainer.classList.contains('stagger-children')) {
                 productListContainer.classList.add('is-visible'); // Or let observer handle it
            }

        }
        function filterProducts(category, btnElement) {
            renderProducts(category, drinkSearchInput.value);
            categoryBtns.forEach(btn => { btn.classList.remove('active', 'bg-sky-500', 'text-white'); btn.classList.add('bg-slate-200', 'text-slate-700', 'hover:bg-sky-100');});
            btnElement.classList.add('active', 'bg-sky-500', 'text-white');
            btnElement.classList.remove('bg-slate-200', 'text-slate-700', 'hover:bg-sky-100');}

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock <= 0) { showModalMessage("This item is out of stock."); return; }
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                if (cartItem.quantity < product.stock + cartItem.quantity) { // Check against original stock for this item
                     cartItem.quantity++;
                } else { showModalMessage("Cannot add more than available stock."); return; }
            } else {
                cart.push({ ...product, quantity: 1, originalStock: product.stock }); // Store original stock if needed, or manage stock differently
            }
            product.stock--; // This stock management needs to be robust with localStorage cart
            updateCartDisplay();
            renderProducts(categoryBtns.find(b => b.classList.contains('active'))?.getAttribute('onclick').match(/'([^']+)'/)[1] || 'all', drinkSearchInput.value);
            showModalMessage(`${product.name} added to cart!`, "success");
            saveCartToLocalStorage();
        }

        function updateProductStock(productId, change) { // change can be -1 (decrement) or +1 (increment)
            const product = products.find(p => p.id === productId);
            if (product) {
                product.stock += change;
                // Ensure stock doesn't go below 0 if managing directly here,
                // or rely on initialProductStocks for resets.
                if (product.stock < 0) product.stock = 0;
            }
        }

        function increaseCartItemQuantity(productId) {
            const cartItem = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId); // Find the actual product from product list
            if (cartItem && product) {
                // Check against the current stock of the product in the main `products` array
                if (product.stock > 0) { // If there's still stock available in the catalog
                    cartItem.quantity++;
                    updateProductStock(productId, -1); // Decrement stock in catalog
                    updateCartDisplay();
                    saveCartToLocalStorage();
                } else {
                    showModalMessage("No more stock available for " + product.name, "info");
                }
            }
        }

        function decreaseCartItemQuantity(productId) {
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.quantity--;
                updateProductStock(productId, 1); // Increment stock in catalog
                if (cartItem.quantity <= 0) {
                    removeFromCart(productId); // This will also call updateCartDisplay and save
                } else {
                    updateCartDisplay();
                    saveCartToLocalStorage();
                }
            }
        }

        function removeFromCart(productId, fromReviewPage = false) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                const removedItem = cart[itemIndex];
                updateProductStock(productId, removedItem.quantity); // Add all quantity back to stock
                cart.splice(itemIndex, 1);

                if (fromReviewPage) updateCartReviewDisplay();
                updateCartDisplay(); // This updates cart view modal and badge
                renderProducts(categoryBtns.find(b => b.classList.contains('active'))?.getAttribute('onclick').match(/'([^']+)'/)[1] || 'all', drinkSearchInput.value);
                saveCartToLocalStorage();
            }
        }

        function clearCart() {
            cart.forEach(item => {
                updateProductStock(item.id, item.quantity); // Add quantities back to catalog stock
            });
            cart = [];
            updateCartDisplay();
            renderProducts(categoryBtns.find(b => b.classList.contains('active'))?.getAttribute('onclick').match(/'([^']+)'/)[1] || 'all', drinkSearchInput.value);
            saveCartToLocalStorage();
            showModalMessage("Cart cleared!", "info");
        }

        function toggleCartView() {
            const isOpen = cartViewModal.classList.contains('open');
            if (isOpen) {
                cartViewModal.classList.remove('open');
                // Wait for animation to finish before setting display none
                setTimeout(() => { if(!cartViewModal.classList.contains('open')) cartViewModal.style.display = "none"; }, 350); // Match transition duration
            } else {
                cartViewModal.style.display = "flex"; // Set display flex before adding open for transition
                setTimeout(() => cartViewModal.classList.add('open'), 10); // Small delay to ensure display is applied
                updateCartDisplay();
            }
        }

        function proceedToCheckoutFromCartView() {
            toggleCartView(); // Close cart modal
            showSection('order', true); // Go to order page, skip full reset
            orderSteps.locationSelection.classList.add('hidden'); // Hide location
            orderSteps.productBrowsing.classList.add('hidden'); // Hide products
            orderSteps.cartReview.classList.remove('hidden'); // Show review step
            updateCartReviewDisplay(); // Populate review step
            loadUserDetailsFromLocalStorage(); // Pre-fill guest details
        }

        function updateCartDisplay() {
            const cartDesktopBadge = document.getElementById('cart-count-badge-desktop');
            const cartMobileBadge = document.getElementById('cart-count-badge-mobile');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (totalItems > 0) {
                cartDesktopBadge.textContent = totalItems;
                cartMobileBadge.textContent = totalItems;
                cartDesktopBadge.classList.remove('hidden');
                cartMobileBadge.classList.remove('hidden');
                // Trigger animation for badge update
                cartDesktopBadge.classList.add('updated');
                cartMobileBadge.classList.add('updated');
                setTimeout(() => {
                    cartDesktopBadge.classList.remove('updated');
                    cartMobileBadge.classList.remove('updated');
                }, 500); // Match animation duration
            } else {
                cartDesktopBadge.classList.add('hidden');
                cartMobileBadge.classList.add('hidden');
            }

            // Update Cart View Modal
            if (!cartViewItemsContainer || !cartViewSubtotalEl || !cartViewEmptyMsg) return;

            if (cart.length === 0) {
                cartViewItemsContainer.innerHTML = ''; // Clear previous items
                cartViewEmptyMsg.classList.remove('hidden');
                cartViewCheckoutBtn.disabled = true;
            } else {
                cartViewEmptyMsg.classList.add('hidden');
                cartViewCheckoutBtn.disabled = false;
                cartViewItemsContainer.innerHTML = cart.map(item => `
                    <div class="cart-view-item data-product-id="${item.id}">
                        <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/64x64/e2e8f0/64748b?text=N/A';">
                        <div class="cart-view-item-details">
                            <h5>${item.name}</h5>
                            <p>₦${item.price.toLocaleString()}</p>
                        </div>
                        <div class="cart-view-item-quantity flex items-center">
                            <button onclick="decreaseCartItemQuantity(${item.id})">-</button>
                            <span class="mx-2">${item.quantity}</span>
                            <button onclick="increaseCartItemQuantity(${item.id})">+</button>
                        </div>
                        <p class="cart-view-item-price ml-4 w-20 text-right">₦${(item.price * item.quantity).toLocaleString()}</p>
                        <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 ml-3 text-lg p-1"><i class="fas fa-trash-alt"></i></button>
                    </div>
                `).join('');
            }
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartViewSubtotalEl.textContent = `₦${subtotal.toLocaleString()}`;

            // Also update the cart review step if it's visible (though proceedToCartReview handles its full update)
            updateCartReviewDisplay();
        }

        function updateCartReviewDisplay() {
            const cartItemsEl = document.getElementById('cart-items-review');
            const emptyMsgEl = document.getElementById('empty-cart-message-review');
            const subtotalEl = document.getElementById('cart-subtotal-review');
            const totalEl = document.getElementById('cart-total-review');
            const feeEl = document.getElementById('delivery-fee-review');

            if (!feeEl) return; // Exit if elements aren't on the current page/step
            feeEl.textContent = `₦${currentDeliveryFee.toLocaleString()}`;
            if (cart.length === 0) {
                if(cartItemsEl) cartItemsEl.innerHTML = '';
                if(emptyMsgEl) emptyMsgEl.classList.remove('hidden');
            } else {
                if(emptyMsgEl) emptyMsgEl.classList.add('hidden');
                if(cartItemsEl) {
                     cartItemsEl.innerHTML = cart.map(item => `
                        <div class="flex justify-between items-center border-b border-slate-100 py-4">
                            <div>
                                <p class="font-semibold text-slate-700">${item.name} (x${item.quantity})</p>
                                <p class="text-sm text-slate-500">₦${item.price.toLocaleString()} each</p>
                            </div>
                            <div class="flex items-center">
                                <span class="font-semibold text-slate-800 mr-4 text-lg">₦${(item.price * item.quantity).toLocaleString()}</span>
                                <!-- No remove button here, manage from cart view modal or main product list -->
                            </div>
                        </div>`).join('');
                }
            }
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            if(subtotalEl) subtotalEl.textContent = `₦${subtotal.toLocaleString()}`;
            if(totalEl) totalEl.textContent = `₦${(subtotal + (cart.length > 0 ? currentDeliveryFee : 0)).toLocaleString()}`;
        }

        // --- Rating & Review ---
        function setRating(value) { document.getElementById('selected-rating').value = value; highlightStars(value); }
        function highlightStars(value) { document.querySelectorAll('.star-rating .fa-star').forEach(s => s.classList.toggle('selected', s.dataset.value <= value));}
        function submitRatingReview() {
            const rating = document.getElementById('selected-rating').value;
            if (rating === "0") { showModalMessage("Please select a star rating.", "error"); return; }
            console.log("Rating:", rating, "Review:", document.getElementById('review-text').value, "Order:", currentOrderDetails.orderId);
            showModalMessage("Thank you for your feedback!", "success");
            resetToHome(); // This will clear the cart from localStorage
        }
        // --- Map & Location Logic ---
        function populateStatesDropdown() {
            apartmentStateSelect.innerHTML = '<option value="">Select State</option>';
            Object.keys(nigeriaGeoData).sort().forEach(stateName => {
                const option = document.createElement('option');
                option.value = stateName;
                option.textContent = stateName;
                apartmentStateSelect.appendChild(option);
            });
        }

        function populateCitiesDropdown(stateName) {
            apartmentCitySelect.innerHTML = '<option value="">Select City/Town</option>';
            apartmentCitySelect.disabled = true;
            if (stateName && nigeriaGeoData[stateName] && nigeriaGeoData[stateName].cities) {
                nigeriaGeoData[stateName].cities.sort().forEach(cityName => {
                    const option = document.createElement('option');
                    option.value = cityName;
                    option.textContent = cityName;
                    apartmentCitySelect.appendChild(option);
                });
                apartmentCitySelect.disabled = false;
            }
        }

        function handleStateChange() {
            const selectedStateName = apartmentStateSelect.value;
            enteredApartmentAddress.state = selectedStateName;
            enteredApartmentAddress.city = null;
            populateCitiesDropdown(selectedStateName);
            if (selectedStateName && nigeriaGeoData[selectedStateName] && map) {
                map.setView([nigeriaGeoData[selectedStateName].lat, nigeriaGeoData[selectedStateName].lon], nigeriaGeoData[selectedStateName].zoom -1);
            }
            validateLocationSelection();
        }

        function handleCityChange() {
            const selectedCityName = apartmentCitySelect.value;
            const selectedStateName = apartmentStateSelect.value;
            enteredApartmentAddress.city = selectedCityName;

            if (selectedStateName && selectedCityName && nigeriaGeoData[selectedStateName] && map) {
                map.setView([nigeriaGeoData[selectedStateName].lat, nigeriaGeoData[selectedStateName].lon], nigeriaGeoData[selectedStateName].zoom + 1);
            }
            validateLocationSelection();
        }

        function initMap() { // This is for the location selection map
            map = L.map('map').setView([9.0765, 7.3986], 6);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
            addHotelMarkers();
            getUserLocationOrSetDefault();
        }

        function getUserLocationOrSetDefault(forApartmentPrefill = false) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const userLat = position.coords.latitude;
                        const userLon = position.coords.longitude;
                        if (map) {
                           map.setView([userLat, userLon], 13);
                            if (userMarker) map.removeLayer(userMarker);
                            userMarker = L.marker([userLat, userLon], { icon: L.icon({ iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] }) }).addTo(map).bindPopup("Your Current Location").openPopup();
                        }

                        if (selectedLocationType === 'hotel') {
                            findClosestHotel(userLat, userLon);
                        } else if (forApartmentPrefill || selectedLocationType === 'apartment') {
                            let closestState = null, minStateDist = Infinity;
                            for (const stateName in nigeriaGeoData) {
                                const stateData = nigeriaGeoData[stateName];
                                const dist = haversineDistance(userLat, userLon, stateData.lat, stateData.lon);
                                if (dist < minStateDist) { minStateDist = dist; closestState = stateName; }
                            }
                            if (closestState) {
                                apartmentStateSelect.value = closestState;
                                handleStateChange();
                                const prominentCity = nigeriaGeoData[closestState].cities.find(c => ["abuja", "lagos island", "ikeja", "victoria island", "port harcourt"].includes(c.toLowerCase())) || nigeriaGeoData[closestState].cities[0];
                                if(prominentCity) {
                                    apartmentCitySelect.value = prominentCity;
                                    handleCityChange();
                                }
                                showModalMessage(`Detected your approximate location: ${closestState}. Please confirm/adjust.`, "info");
                            }
                        }
                    },
                    () => { showModalMessage("Could not get your location. Please select manually.", "info"); }
                );
            } else {
                showModalMessage("Geolocation is not supported by your browser.", "info");
            }
        }

        function addHotelMarkers() {
            hotelMarkers.forEach(m => map.removeLayer(m)); hotelMarkers = [];
            hotels.forEach(hotel => {
                const marker = L.marker([hotel.lat, hotel.lon]).addTo(map)
                    .bindPopup(`<b>${hotel.name}</b><br><button class="mt-1 text-xs btn btn-primary py-1 px-2" onclick="selectHotelById(${hotel.id})">Select Hotel</button>`);
                marker.on('click', () => selectHotelById(hotel.id) );
                hotelMarkers.push(marker);
            });
        }
        function populateHotelList() {
            const listEl = document.getElementById('hotel-list'); listEl.innerHTML = '';
            hotels.forEach(hotel => {
                const item = document.createElement('div');
                item.className = 'hotel-list-item border border-slate-200 p-3 rounded hover:bg-sky-50';
                item.innerHTML = `<h4 class="font-semibold text-slate-700">${hotel.name}</h4><p class="text-sm text-slate-500">${hotel.address}</p>${hotel.deliveryFee > 0 ? `<p class="text-xs text-amber-600">Delivery: ₦${hotel.deliveryFee.toLocaleString()}</p>` : `<p class="text-xs text-green-600">Delivery fee by distance</p>`}`;
                item.onclick = () => selectHotelById(hotel.id);
                listEl.appendChild(item);
            });
        }
        function selectHotelById(hotelId) {
            selectedHotel = hotels.find(h => h.id === hotelId);
            if (selectedHotel) {
                document.getElementById('selected-hotel-info').innerHTML = `Selected: <span class="font-bold text-sky-700">${selectedHotel.name}</span>`;
                currentDeliveryFee = selectedHotel.deliveryFee > 0 ? selectedHotel.deliveryFee :
                                     Math.round(haversineDistance(MOCK_VENDOR_LOCATION.lat, MOCK_VENDOR_LOCATION.lon, selectedHotel.lat, selectedHotel.lon) * DELIVERY_FEE_PER_KM);
                map.setView([selectedHotel.lat, selectedHotel.lon], 15);
                document.querySelectorAll('#hotel-list .hotel-list-item').forEach(i => i.classList.remove('selected'));
                const selItem = Array.from(document.querySelectorAll('#hotel-list .hotel-list-item')).find(i => i.textContent.includes(selectedHotel.name));
                if(selItem) selItem.classList.add('selected');
                validateLocationSelection();
                updateCartReviewDisplay();
            }
        }
        function haversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; const dLat = (lat2 - lat1) * Math.PI / 180; const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2)**2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2)**2;
            return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
        }
        function findClosestHotel(userLat, userLon) {
            let closest = null, minDist = Infinity;
            hotels.forEach(h => { const dist = haversineDistance(userLat, userLon, h.lat, h.lon); if (dist < minDist) { minDist = dist; closest = h; } });
            if (closest && selectedLocationType === 'hotel') {
                showModalMessage(`Closest hotel: ${closest.name} (${minDist.toFixed(1)} km). Auto-selecting.`, "success");
                selectHotelById(closest.id);
            }
        }
        // --- Modal ---
        function showModalMessage(message, type = 'info') {
            modalMessageText.textContent = message;
            modalMessageText.className = 'text-slate-700 text-lg';
            if (type === 'success') modalMessageText.classList.add('text-green-600');
            else if (type === 'error') modalMessageText.classList.add('text-red-600');

            modal.style.display = "flex"; // Set display before adding class for transition
            setTimeout(() => modal.classList.add('open'), 10); // Small delay ensures display is applied
        }
        function closeModal() {
            modal.classList.remove('open');
            // Wait for animation to finish before setting display none
             setTimeout(() => { if(!modal.classList.contains('open')) modal.style.display = "none"; }, 350); // Match CSS transition duration
        }
        window.onclick = function(event) {
            if (event.target == modal) { closeModal(); }
            if (event.target == cartViewModal) { toggleCartView(); }
        }


  // Service worker registration for PWA:
  if('serviceWorker' in navigator){
    window.addEventListener('load',function(){
      navigator.serviceWorker.register('sw.js').then(
        reg=>console.log("SW Registered",reg),
        err=>console.warn("SW failed!", err)
      );
    });
  }
   </script>
<script>
/* ==============================================================
   1.  GSAP PARALLAX  +  TYPEWRITER
   ============================================================== */
gsap.registerPlugin(ScrollTrigger);

// background parallax
gsap.to("#hero-bg", {
  scale: 1.15,
  yPercent: 15,
  ease: "none",
  scrollTrigger: { trigger: "#home", scrub: true }
});

// looping headline
new Typed("#typewriter", {
  strings: [
   "Buy from us, we're just outside 24/7!",
    "Hotel mini‑bars are pricey",
    "Why should you pay that high?",
    "Skip the mark‑ups",
    "Grab chilled drinks 24 / 7"
  ],
  typeSpeed: 55,
  backSpeed: 35,
  backDelay: 1200,
  loop: true
});


/* ==============================================================
   2.  3‑D TILT ON PRODUCT CARDS
   ============================================================== */
function attachTilt(){
  document.querySelectorAll(".product-card").forEach(card=>{
    card.classList.add("tilt","no‑tap");
    card.addEventListener("mousemove", e=>{
      const r = card.getBoundingClientRect(),
            x = e.clientX - r.left - r.width/2,
            y = e.clientY - r.top  - r.height/2;
      card.style.transform = `rotateY(${ x/20 }deg) rotateX(${ -y/20 }deg)`;
    });
    card.addEventListener("mouseleave", ()=>card.style.transform="");
  });
}

// run once after products first render
document.addEventListener("DOMContentLoaded", attachTilt);
// run again each time you re‑render product list
const _renderProducts = window.renderProducts;
window.renderProducts = function(){
  _renderProducts.apply(this, arguments);
  attachTilt();
};


/* ==============================================================
   3.  ADD‑TO‑CART  “FLY”  EFFECT
   ============================================================== */
const oldAdd = window.addToCart;
window.addToCart = function(id){
  const img = document.querySelector(`[onclick="addToCart(${id})"]`)?.closest(".product-card")?.querySelector("img"),
        cart = document.getElementById("cart-icon-desktop") || document.getElementById("cart-icon-mobile");
  if(img && cart){
    const clone = img.cloneNode(),
          from  = img.getBoundingClientRect(),
          to    = cart.getBoundingClientRect();
    Object.assign(clone.style,{
      position:"fixed",left:`${from.left}px`,top:`${from.top}px`,
      width:`${from.width}px`,height:`${from.height}px`,zIndex:9999,
      transition:"transform .7s var(--ease-elastic),opacity .7s",
      pointerEvents:"none"
    });
    document.body.appendChild(clone);
    requestAnimationFrame(()=>{
      clone.style.transform=`translate(${to.left-from.left}px,${to.top-from.top}px) scale(.1)`;
      clone.style.opacity=0;
    });
    clone.addEventListener("transitionend",()=>clone.remove());
  }
  oldAdd(id);
};


/* ==============================================================
   4.  LOW‑STOCK BADGE PULSE  (<=3 left)
   ============================================================== */
function pulseBadges(){
  document.querySelectorAll("[data-stock]").forEach(b=>{
    if(+b.dataset.stock<=3) b.classList.add("animate-ping","animate-once","animate-duration-2000");
  });
}
document.addEventListener("DOMContentLoaded", pulseBadges);


/* ==============================================================
   5.  OPTIONAL : SOCIAL‑PROOF COUNT‑UP  (if element exists)
   ============================================================== */
function animateCounts(){
  const el=document.getElementById("ordersLastHour");
  if(!el) return;
  const target=+el.dataset.target||26;
  gsap.fromTo(el,{innerText:0},{innerText:target,duration:2,ease:"power1.in",snap:{innerText:1}});
}
document.addEventListener("DOMContentLoaded", animateCounts);
</script>
</body>
</html>
